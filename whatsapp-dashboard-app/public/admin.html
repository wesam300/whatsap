<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة الإدارة - واتساب داشبورد</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* دعم كامل للعربية */
        body {
            direction: rtl;
            text-align: right;
            font-family: 'Segoe UI', 'Tahoma', 'Arial', sans-serif;
        }

        .ltr {
            direction: ltr;
            text-align: left;
        }

        .language-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .language-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        body {
            background: #f5f5f5;
            min-height: 100vh;
        }

        .navbar {
            background: #25D366;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar h1 {
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .navbar h1::before {
            content: "⚙️";
            font-size: 28px;
        }

        .navbar .nav-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .header-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .header-section h2 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #25D366;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
            color: #666;
        }

        .tab-button.active {
            background: #25D366;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .content-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .user-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .user-card:hover {
            border-color: #25D366;
            box-shadow: 0 3px 10px rgba(37, 211, 102, 0.1);
        }

        .user-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .user-info h6 {
            color: #333;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .user-info p {
            color: #666;
            margin: 0;
        }

        .user-status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status-admin {
            background: #cce5ff;
            color: #004085;
        }

        .status-expired {
            background: #f8d7da;
            color: #721c24;
        }

        .user-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            text-align: center;
        }

        .detail-label {
            color: #666;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .detail-value {
            color: #333;
            font-weight: 600;
        }

        .user-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background: #25D366;
            color: white;
        }

        .btn-primary:hover {
            background: #128C7E;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            background: #25D366;
            color: white;
            padding: 20px 30px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 20px;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            background: none;
        }

        .close:hover {
            opacity: 0.7;
        }

        .modal-body {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #25D366;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .modal-footer {
            padding: 20px 30px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            z-index: 9999;
            min-width: 300px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.warning {
            background: #ffc107;
            color: #333;
        }

        .notification.info {
            background: #17a2b8;
        }

        .bulk-actions {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .bulk-actions.show {
            display: block;
        }

        .search-box {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .search-box:focus {
            outline: none;
            border-color: #25D366;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #25D366;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .user-details {
                grid-template-columns: 1fr;
            }
            
            .user-actions {
                justify-content: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .text-danger {
            color: #dc3545 !important;
        }

        .text-warning {
            color: #ffc107 !important;
        }

        .btn-group {
            display: flex;
            gap: 5px;
        }

        .btn-group .btn {
            flex: 1;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <h1>لوحة الإدارة</h1>
        <div class="nav-actions">
            <button class="language-toggle" onclick="toggleLanguage()" id="languageToggle">English</button>
            <a href="/dashboard" class="back-btn">← العودة للرئيسية</a>
            <button class="back-btn" onclick="logout()">تسجيل الخروج</button>
        </div>
    </nav>

    <div class="container">
        <!-- Header -->
        <div class="header-section">
            <h2>⚙️ لوحة الأدمن</h2>
            <p>إدارة المستخدمين والجلسات والنظام</p>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalUsers">0</div>
                <div class="stat-label">إجمالي المستخدمين</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="activeUsers">0</div>
                <div class="stat-label">المستخدمين النشطين</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalSessions">0</div>
                <div class="stat-label">إجمالي الجلسات</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="connectedSessions">0</div>
                <div class="stat-label">الجلسات المتصلة</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalMessages">0</div>
                <div class="stat-label">الرسائل المرسلة</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="apiCalls">0</div>
                <div class="stat-label">استدعاءات API</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('users')">
                👥 المستخدمين
            </button>
            <button class="tab-button" onclick="switchTab('sessions')">
                📱 الجلسات
            </button>
            <button class="tab-button" onclick="switchTab('packages')">
                📦 الباقات
            </button>
            <button class="tab-button" onclick="switchTab('settings')">
                ⚙️ الإعدادات
            </button>
        </div>

        <!-- Users Tab -->
        <div id="users-tab" class="tab-content active">
            <div class="content-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>👥 إدارة المستخدمين</h3>
                    <div>
                        <button class="btn btn-primary" onclick="showAddUserModal()">
                            ➕ إضافة مستخدم
                        </button>
                        <button class="btn btn-secondary" onclick="toggleBulkActions()">
                            📋 إجراءات جماعية
                        </button>
                    </div>
                </div>
                
                <input type="text" class="search-box" id="userSearch" placeholder="🔍 البحث في المستخدمين..." onkeyup="searchUsers()">
                
                <div class="bulk-actions" id="bulkActions">
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span>المحدد: <span id="selectedCount">0</span></span>
                        <button class="btn btn-warning" onclick="bulkToggleStatus()">تفعيل/إيقاف</button>
                        <button class="btn btn-info" onclick="bulkUpdateSessions()">تحديث الجلسات</button>
                        <button class="btn btn-danger" onclick="bulkDelete()">حذف</button>
                        <button class="btn btn-secondary" onclick="clearSelection()">إلغاء التحديد</button>
                    </div>
                </div>
                
                <div id="usersList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>جاري تحميل المستخدمين...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sessions Tab -->
        <div id="sessions-tab" class="tab-content">
            <div class="content-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>📱 إدارة الجلسات</h3>
                    <button class="btn btn-warning" onclick="cleanupExpiredSessions()">
                        🧹 تنظيف الجلسات المنتهية
                    </button>
                </div>
                <div id="sessionsList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>جاري تحميل الجلسات...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Packages Tab -->
        <div id="packages-tab" class="tab-content">
            <div class="content-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>📦 إدارة الباقات</h3>
                    <button class="btn btn-primary" onclick="showAddPackageModal()">
                        ➕ إضافة باقة
                    </button>
                </div>
                <div id="packagesList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>جاري تحميل الباقات...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
            <div class="content-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>⚙️ إعدادات النظام</h3>
                    <a href="/limits.html" class="btn btn-info" target="_blank">
                        📊 عرض حدود النظام
                    </a>
                </div>
                <div id="settingsContent">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>جاري تحميل الإعدادات...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>➕ إضافة مستخدم جديد</h3>
                <button class="close" onclick="closeModal('addUserModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label for="newUsername">اسم المستخدم</label>
                        <input type="text" id="newUsername" placeholder="أدخل اسم المستخدم" required>
                    </div>
                    <div class="form-group">
                        <label for="newEmail">البريد الإلكتروني</label>
                        <input type="email" id="newEmail" placeholder="أدخل البريد الإلكتروني" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">كلمة المرور</label>
                        <input type="password" id="newPassword" placeholder="أدخل كلمة المرور" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newMaxSessions">الحد الأقصى للجلسات</label>
                            <input type="number" id="newMaxSessions" placeholder="1" value="1" min="1" max="10" required>
                        </div>
                        <div class="form-group">
                            <label for="newSessionDays">عدد الأيام لكل جلسة</label>
                            <input type="number" id="newSessionDays" placeholder="30" value="30" min="1" max="365" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="newIsAdmin" style="width: auto;">
                            صلاحيات أدمن
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addUserModal')">إلغاء</button>
                <button class="btn btn-primary" onclick="addUser()">إضافة المستخدم</button>
            </div>
        </div>
    </div>

    <!-- Edit User Limits Modal -->
    <div id="editLimitsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>⚙️ تعديل حدود الجلسات</h3>
                <button class="close" onclick="closeModal('editLimitsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editLimitsForm">
                    <input type="hidden" id="editLimitsUserId">
                    <div class="form-group">
                        <label for="editMaxSessions">عدد الجلسات المسموحة</label>
                        <input type="number" id="editMaxSessions" min="1" max="1000" required>
                        <small class="form-text">الحد الأقصى: 1000 جلسة</small>
                    </div>
                    <div class="form-group">
                        <label for="editSessionTtlDays">عدد أيام انتهاء الجلسة</label>
                        <input type="number" id="editSessionTtlDays" min="1" max="9999" required>
                        <small class="form-text">الحد الأقصى: 9999 يوم (أكثر من 27 سنة!)</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editLimitsModal')">إلغاء</button>
                <button class="btn btn-primary" onclick="updateUserLimits()">حفظ التغييرات</button>
            </div>
        </div>
    </div>

    <!-- Session Control Modal -->
    <div id="sessionControlModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>🎛️ تحكم في الجلسة</h3>
                <button class="close" onclick="closeModal('sessionControlModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="sessionControlForm">
                    <input type="hidden" id="sessionControlId">
                    <div class="form-group">
                        <label for="sessionMaxDays">الحد الأقصى للأيام</label>
                        <input type="number" id="sessionMaxDays" min="1" max="9999" required>
                        <small class="form-text">الحد الأقصى: 9999 يوم (أكثر من 27 سنة!)</small>
                    </div>
                    <div class="form-group">
                        <label for="sessionDaysRemaining">الأيام المتبقية</label>
                        <input type="number" id="sessionDaysRemaining" min="0" max="9999" required>
                        <small class="form-text">عدد الأيام المتبقية للجلسة</small>
                    </div>
                    <div class="form-group">
                        <label for="sessionIsPaused">حالة الجلسة</label>
                        <select id="sessionIsPaused" class="form-control">
                            <option value="false">نشطة</option>
                            <option value="true">معلقة</option>
                        </select>
                    </div>
                    <div class="form-group" id="pauseReasonGroup" style="display: none;">
                        <label for="sessionPauseReason">سبب الإيقاف</label>
                        <input type="text" id="sessionPauseReason" placeholder="أدخل سبب إيقاف الجلسة">
                    </div>
                    <div class="form-group">
                        <label>تحديث سريع</label>
                        <div class="btn-group" style="width: 100%;">
                            <button type="button" class="btn btn-success" onclick="extendSession(7)">+7 أيام</button>
                            <button type="button" class="btn btn-success" onclick="extendSession(30)">+30 يوم</button>
                            <button type="button" class="btn btn-success" onclick="extendSession(90)">+90 يوم</button>
                            <button type="button" class="btn btn-success" onclick="extendSession(365)">+1 سنة</button>
                            <button type="button" class="btn btn-success" onclick="extendSession(1095)">+3 سنوات</button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('sessionControlModal')">إلغاء</button>
                <button class="btn btn-primary" onclick="updateSessionSettings()">حفظ التغييرات</button>
            </div>
        </div>
    </div>

    <!-- System Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>⚙️ إعدادات النظام العامة</h3>
                <button class="close" onclick="closeModal('settingsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="settingsForm">
                    <div class="form-group">
                        <label for="adminPhone">رقم هاتف الإدارة</label>
                        <input type="tel" id="adminPhone" placeholder="+966xxxxxxxxx">
                        <small class="form-text">رقم هاتف الإدارة للتواصل مع المستخدمين</small>
                    </div>
                    <div class="form-group">
                        <label for="defaultMaxSessions">الحد الأقصى الافتراضي للجلسات</label>
                        <input type="number" id="defaultMaxSessions" min="1" max="1000" value="5">
                        <small class="form-text">عدد الجلسات الافتراضي للمستخدمين الجدد (الحد الأقصى: 1000)</small>
                    </div>
                    <div class="form-group">
                        <label for="defaultSessionDays">عدد أيام الجلسة الافتراضي</label>
                        <input type="number" id="defaultSessionDays" min="1" max="9999" value="30">
                        <small class="form-text">عدد أيام انتهاء الجلسة الافتراضي</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('settingsModal')">إلغاء</button>
                <button class="btn btn-primary" onclick="updateSettings()">حفظ الإعدادات</button>
            </div>
        </div>
    </div>

    <!-- Add Package Modal -->
    <div id="addPackageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📦 إضافة باقة جديدة</h3>
                <button class="close" onclick="closeModal('addPackageModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addPackageForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="packageId">معرف الباقة</label>
                            <input type="text" id="packageId" placeholder="مثال: basic, premium, pro" required>
                        </div>
                        <div class="form-group">
                            <label for="packageName">اسم الباقة</label>
                            <input type="text" id="packageName" placeholder="مثال: الباقة الأساسية" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="packagePrice">السعر (USD)</label>
                            <input type="number" id="packagePrice" placeholder="0.00" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="packageDuration">المدة بالأيام</label>
                            <input type="number" id="packageDuration" placeholder="30" min="1" max="365" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="packageMaxSessions">الحد الأقصى للجلسات</label>
                        <input type="number" id="packageMaxSessions" placeholder="1" min="1" max="10" required>
                    </div>
                    <div class="form-group">
                        <label for="packageFeatures">المميزات (سطر واحد لكل ميزة)</label>
                        <textarea id="packageFeatures" placeholder="مثال:&#10;إرسال رسائل غير محدود&#10;دعم الملفات&#10;API متقدم" style="height: 100px"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addPackageModal')">إلغاء</button>
                <button class="btn btn-primary" onclick="addPackage()">إضافة الباقة</button>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="editUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>✏️ تعديل المستخدم</h3>
                <button class="close" onclick="closeModal('editUserModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editUserForm">
                    <input type="hidden" id="editUserId">
                    <div class="form-group">
                        <label for="editUsername">اسم المستخدم</label>
                        <input type="text" id="editUsername" required>
                    </div>
                    <div class="form-group">
                        <label for="editEmail">البريد الإلكتروني</label>
                        <input type="email" id="editEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="editPassword">كلمة المرور الجديدة (اتركها فارغة للاحتفاظ بالحالية)</label>
                        <input type="password" id="editPassword">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editMaxSessions">الحد الأقصى للجلسات</label>
                            <input type="number" id="editMaxSessions" min="1" max="10" required>
                        </div>
                        <div class="form-group">
                            <label for="editSessionDays">عدد الأيام لكل جلسة</label>
                            <input type="number" id="editSessionDays" min="1" max="365" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="editIsAdmin" style="width: auto;">
                            صلاحيات أدمن
                        </label>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="editIsActive" style="width: auto;">
                            الحساب نشط
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editUserModal')">إلغاء</button>
                <button class="btn btn-primary" onclick="updateUser()">حفظ التغييرات</button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let users = [];
        let packages = [];
        let subscriptions = [];
        let sessions = [];
        let selectedUsers = new Set();
        let currentTab = 'users';
        let currentLanguage = 'ar'; // اللغة الافتراضية

        // ترجمة النصوص
        const translations = {
            ar: {
                title: 'لوحة الإدارة',
                backToHome: '← العودة للرئيسية',
                logout: 'تسجيل الخروج',
                english: 'English',
                adminPanel: 'لوحة الأدمن',
                adminPanelDesc: 'إدارة المستخدمين والجلسات والنظام',
                users: 'المستخدمين',
                sessions: 'الجلسات',
                packages: 'الباقات',
                settings: 'الإعدادات',
                addUser: 'إضافة مستخدم',
                bulkActions: 'إجراءات جماعية',
                addPackage: 'إضافة باقة',
                cleanupExpired: 'تنظيف الجلسات المنتهية',
                editLimits: 'حدود الجلسات',
                edit: 'تعديل',
                pause: 'إيقاف',
                resume: 'تفعيل',
                sessions: 'الجلسات',
                delete: 'حذف',
                view: 'عرض',
                restart: 'إعادة تشغيل',
                created: 'تاريخ الإنشاء',
                lastUpdated: 'آخر تحديث',
                expires: 'انتهاء الصلاحية',
                expired: 'منتهية',
                daysRemaining: 'يوم متبقي',
                confirmDelete: 'هل أنت متأكد من حذف هذا العنصر؟',
                confirmCleanup: 'هل أنت متأكد من تنظيف الجلسات المنتهية الصلاحية؟'
            },
            en: {
                title: 'Admin Panel',
                backToHome: '← Back to Home',
                logout: 'Logout',
                english: 'العربية',
                adminPanel: 'Admin Panel',
                adminPanelDesc: 'Manage users, sessions and system',
                users: 'Users',
                sessions: 'Sessions',
                packages: 'Packages',
                settings: 'Settings',
                addUser: 'Add User',
                bulkActions: 'Bulk Actions',
                addPackage: 'Add Package',
                cleanupExpired: 'Cleanup Expired Sessions',
                editLimits: 'Session Limits',
                edit: 'Edit',
                pause: 'Pause',
                resume: 'Resume',
                sessions: 'Sessions',
                delete: 'Delete',
                view: 'View',
                restart: 'Restart',
                created: 'Created',
                lastUpdated: 'Last Updated',
                expires: 'Expires',
                expired: 'Expired',
                daysRemaining: 'days remaining',
                confirmDelete: 'Are you sure you want to delete this item?',
                confirmCleanup: 'Are you sure you want to cleanup expired sessions?'
            }
        };

        // وظيفة تبديل اللغة
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
            document.documentElement.lang = currentLanguage;
            document.documentElement.dir = currentLanguage === 'ar' ? 'rtl' : 'ltr';
            updateLanguage();
        }

        // تحديث النصوص حسب اللغة
        function updateLanguage() {
            const t = translations[currentLanguage];
            
            // تحديث العنوان
            document.querySelector('h1').textContent = t.title;
            
            // تحديث زر اللغة
            document.getElementById('languageToggle').textContent = t.english;
            
            // تحديث الروابط
            document.querySelector('a[href="/dashboard"]').textContent = t.backToHome;
            document.querySelector('button[onclick="logout()"]').textContent = t.logout;
            
            // إعادة تحميل البيانات
            loadStats();
            loadUsers();
            loadSessions();
        }

        // Load data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadUserInfo();
            loadStats();
            loadUsers();
            loadSessions();
            loadPackages();
            loadSettings();
        });

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            
            currentTab = tabName;

            // Load data for the tab
            switch(tabName) {
                case 'users':
                    loadUsers();
                    break;
                case 'sessions':
                    loadSessions();
                    break;
                case 'packages':
                    loadPackages();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }

        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
            modal.classList.remove('show');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        async function loadUserInfo() {
            try {
                const response = await fetch('/api/me');
                const data = await response.json();
                if (data.success) {
                    currentUser = data.user;
                    if (!currentUser.isAdmin) {
                        window.location.href = '/dashboard';
                    }
                }
            } catch (error) {
                console.error('Error loading user info:', error);
                window.location.href = '/dashboard';
            }
        }

        // User management functions
        function showAddUserModal() {
            document.getElementById('addUserForm').reset();
            // إظهار Modal
            const modal = document.getElementById('addUserModal');
            modal.style.display = 'block';
            modal.classList.add('show');
        }

        function showAddPackageModal() {
            document.getElementById('addPackageForm').reset();
            showModal('addPackageModal');
        }

        async function addUser() {
            const username = document.getElementById('newUsername').value.trim();
            const email = document.getElementById('newEmail').value.trim();
            const password = document.getElementById('newPassword').value;
            const maxSessions = parseInt(document.getElementById('newMaxSessions').value);
            const sessionDays = parseInt(document.getElementById('newSessionDays').value);
            const isAdmin = document.getElementById('newIsAdmin').checked;

            if (!username || !email || !password) {
                showNotification('error', 'يرجى ملء جميع الحقول المطلوبة');
                return;
            }

            try {
                const response = await fetch('/api/admin/users', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username, email, password, maxSessions, sessionDays, isAdmin
                    })
                });

                const data = await response.json();
                if (data.success) {
                    closeModal('addUserModal');
                    showNotification('success', 'تم إضافة المستخدم بنجاح');
                    loadUsers();
                    loadStats();
                } else {
                    showNotification('error', data.error || 'فشل في إضافة المستخدم');
                }
            } catch (error) {
                console.error('Error adding user:', error);
                showNotification('error', 'فشل في إضافة المستخدم');
            }
        }

        // Notification system
        function showNotification(type, message) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                ${type === 'success' ? '✅' : type === 'error' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️'} ${message}
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 5000);
        }

        async function logout() {
            try {
                const response = await fetch('/api/logout', {
                    method: 'POST'
                });
                
                if (response.ok) {
                    window.location.href = '/';
                }
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = '/';
            }
        }

        async function loadUsers() {
            try {
                const response = await fetch('/api/admin/users');
                const data = await response.json();
                if (data.success) {
                    users = data.users;
                    displayUsers();
                }
            } catch (error) {
                console.error('Error loading users:', error);
                showNotification('error', 'فشل في تحميل المستخدمين');
            }
        }

        async function loadStats() {
            try {
                const response = await fetch('/api/admin/stats');
                const data = await response.json();
                if (data.success) {
                    const stats = data.stats;
                    document.getElementById('totalUsers').textContent = stats.totalUsers || 0;
                    document.getElementById('activeUsers').textContent = stats.activeUsers || 0;
                    document.getElementById('totalSessions').textContent = stats.totalSessions || 0;
                    document.getElementById('connectedSessions').textContent = stats.connectedSessions || 0;
                    document.getElementById('totalMessages').textContent = stats.totalMessages || 0;
                    document.getElementById('apiCalls').textContent = stats.apiCalls || 0;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Additional functions
        function editUser(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;

            document.getElementById('editUserId').value = user.id;
            document.getElementById('editUsername').value = user.username;
            document.getElementById('editEmail').value = user.email;
            document.getElementById('editMaxSessions').value = user.max_sessions || 1;
            document.getElementById('editSessionDays').value = user.session_ttl_days || 30;
            document.getElementById('editIsAdmin').checked = user.is_admin || false;
            document.getElementById('editIsActive').checked = user.is_active || false;

            showModal('editUserModal');
        }

        async function updateUser() {
            const userId = document.getElementById('editUserId').value;
            const username = document.getElementById('editUsername').value.trim();
            const email = document.getElementById('editEmail').value.trim();
            const password = document.getElementById('editPassword').value;
            const maxSessions = parseInt(document.getElementById('editMaxSessions').value);
            const sessionDays = parseInt(document.getElementById('editSessionDays').value);
            const isAdmin = document.getElementById('editIsAdmin').checked;
            const isActive = document.getElementById('editIsActive').checked;

            if (!username || !email) {
                showNotification('error', 'يرجى ملء جميع الحقول المطلوبة');
                return;
            }

            try {
                const response = await fetch(`/api/admin/users/${userId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username, email, password, maxSessions, sessionDays, isAdmin, isActive
                    })
                });

                const data = await response.json();
                if (data.success) {
                    closeModal('editUserModal');
                    showNotification('success', 'تم تحديث المستخدم بنجاح');
                    loadUsers();
                    loadStats();
                } else {
                    showNotification('error', data.error || 'فشل في تحديث المستخدم');
                }
            } catch (error) {
                console.error('Error updating user:', error);
                showNotification('error', 'فشل في تحديث المستخدم');
            }
        }

        async function toggleUserStatus(userId) {
            try {
                const response = await fetch(`/api/admin/users/${userId}/toggle`, {
                    method: 'POST'
                });

                const data = await response.json();
                if (data.success) {
                    showNotification('success', 'تم تحديث حالة المستخدم بنجاح');
                    loadUsers();
                    loadStats();
                } else {
                    showNotification('error', data.error || 'فشل في تحديث حالة المستخدم');
                }
            } catch (error) {
                console.error('Error toggling user status:', error);
                showNotification('error', 'فشل في تحديث حالة المستخدم');
            }
        }

        async function deleteUser(userId) {
            if (!confirm('هل أنت متأكد من حذف هذا المستخدم؟ سيتم حذف جميع جلساته أيضاً.')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/users/${userId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                if (data.success) {
                    showNotification('success', 'تم حذف المستخدم بنجاح');
                    loadUsers();
                    loadStats();
                } else {
                    showNotification('error', data.error || 'فشل في حذف المستخدم');
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                showNotification('error', 'فشل في حذف المستخدم');
            }
        }

        // Bulk actions
        function toggleUserSelection(userId) {
            if (selectedUsers.has(userId)) {
                selectedUsers.delete(userId);
            } else {
                selectedUsers.add(userId);
            }
            updateBulkActions();
        }

        function updateBulkActions() {
            const count = selectedUsers.size;
            document.getElementById('selectedCount').textContent = count;
            document.getElementById('bulkActions').classList.toggle('show', count > 0);
        }

        function toggleBulkActions() {
            const bulkActions = document.getElementById('bulkActions');
            bulkActions.classList.toggle('show');
        }

        function clearSelection() {
            selectedUsers.clear();
            document.querySelectorAll('.user-checkbox').forEach(cb => cb.checked = false);
            updateBulkActions();
        }

        function searchUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const userCards = document.querySelectorAll('.user-card');
            
            userCards.forEach(card => {
                const username = card.querySelector('h6').textContent.toLowerCase();
                const email = card.querySelector('p').textContent.toLowerCase();
                
                if (username.includes(searchTerm) || email.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Package management
        async function addPackage() {
            const id = document.getElementById('packageId').value.trim();
            const name = document.getElementById('packageName').value.trim();
            const price = parseFloat(document.getElementById('packagePrice').value);
            const durationDays = parseInt(document.getElementById('packageDuration').value);
            const maxSessions = parseInt(document.getElementById('packageMaxSessions').value);
            const features = document.getElementById('packageFeatures').value.split('\n').filter(f => f.trim());

            if (!id || !name || !price || !durationDays || !maxSessions) {
                showNotification('error', 'يرجى ملء جميع الحقول المطلوبة');
                return;
            }

            try {
                const response = await fetch('/api/admin/packages', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        id, name, price, durationDays, maxSessions, features
                    })
                });

                const data = await response.json();
                if (data.success) {
                    closeModal('addPackageModal');
                    showNotification('success', 'تم إضافة الباقة بنجاح');
                    loadPackages();
                } else {
                    showNotification('error', data.error || 'فشل في إضافة الباقة');
                }
            } catch (error) {
                console.error('Error adding package:', error);
                showNotification('error', 'فشل في إضافة الباقة');
            }
        }

        function editPackage(packageId) {
            showNotification('info', 'ميزة تعديل الباقة قيد التطوير');
        }

        async function deletePackage(packageId) {
            if (!confirm('هل أنت متأكد من حذف هذه الباقة؟')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/packages/${packageId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                if (data.success) {
                    showNotification('success', 'تم حذف الباقة بنجاح');
                    loadPackages();
                } else {
                    showNotification('error', data.error || 'فشل في حذف الباقة');
                }
            } catch (error) {
                console.error('Error deleting package:', error);
                showNotification('error', 'فشل في حذف الباقة');
            }
        }

        // Session management
        function viewSession(sessionId) {
            window.open(`/session/${sessionId}`, '_blank');
        }

        async function restartSession(sessionId) {
            try {
                const response = await fetch(`/api/admin/sessions/${sessionId}/restart`, {
                    method: 'POST'
                });

                const data = await response.json();
                if (data.success) {
                    showNotification('success', 'تم إعادة تشغيل الجلسة بنجاح');
                    loadSessions();
                } else {
                    showNotification('error', data.error || 'فشل في إعادة تشغيل الجلسة');
                }
            } catch (error) {
                console.error('Error restarting session:', error);
                showNotification('error', 'فشل في إعادة تشغيل الجلسة');
            }
        }

        async function deleteSession(sessionId) {
            if (!confirm('هل أنت متأكد من حذف هذه الجلسة؟')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/sessions/${sessionId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                if (data.success) {
                    showNotification('success', 'تم حذف الجلسة بنجاح');
                    loadSessions();
                    loadStats();
                } else {
                    showNotification('error', data.error || 'فشل في حذف الجلسة');
                }
            } catch (error) {
                console.error('Error deleting session:', error);
                showNotification('error', 'فشل في حذف الجلسة');
            }
        }

        function viewUserSessions(userId) {
            switchTab('sessions');
            // Filter sessions by user
            const userSessions = sessions.filter(s => s.user_id === userId);
            if (userSessions.length === 0) {
                showNotification('info', 'لا توجد جلسات لهذا المستخدم');
            }
        }

        function editSettings() {
            // تحميل الإعدادات الحالية
            loadSettings();
            // إظهار Modal
            const modal = document.getElementById('settingsModal');
            modal.style.display = 'block';
            modal.classList.add('show');
        }

        async function loadSettings() {
            try {
                const response = await fetch('/api/admin/settings');
                const data = await response.json();
                if (data.success) {
                    document.getElementById('adminPhone').value = data.settings.adminPhone || '';
                    document.getElementById('defaultMaxSessions').value = data.settings.defaultMaxSessions || 5;
                    document.getElementById('defaultSessionDays').value = data.settings.defaultSessionDays || 30;
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        async function updateSettings() {
            const adminPhone = document.getElementById('adminPhone').value.trim();
            const defaultMaxSessions = parseInt(document.getElementById('defaultMaxSessions').value);
            const defaultSessionDays = parseInt(document.getElementById('defaultSessionDays').value);

            if (defaultMaxSessions < 1 || defaultMaxSessions > 1000) {
                showNotification('error', 'الحد الأقصى للجلسات يجب أن يكون بين 1 و 1000');
                return;
            }

            if (defaultSessionDays < 1 || defaultSessionDays > 9999) {
                showNotification('error', 'عدد أيام الجلسة يجب أن يكون بين 1 و 9999');
                return;
            }

            try {
                const response = await fetch('/api/admin/settings', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        adminPhone,
                        defaultMaxSessions,
                        defaultSessionDays
                    })
                });

                const data = await response.json();
                if (data.success) {
                    closeModal('settingsModal');
                    showNotification('success', 'تم حفظ الإعدادات بنجاح');
                    loadSettings(); // إعادة تحميل الإعدادات
                } else {
                    showNotification('error', data.error || 'فشل في حفظ الإعدادات');
                }
            } catch (error) {
                console.error('Error updating settings:', error);
                showNotification('error', 'فشل في حفظ الإعدادات');
            }
        }

        // تنظيف الجلسات المنتهية الصلاحية
        async function cleanupExpiredSessions() {
            if (!confirm('هل أنت متأكد من تنظيف الجلسات المنتهية الصلاحية؟')) {
                return;
            }

            try {
                const response = await fetch('/api/admin/cleanup-expired-sessions', {
                    method: 'POST'
                });

                const data = await response.json();
                if (data.success) {
                    showNotification('success', data.message);
                    loadSessions();
                } else {
                    showNotification('error', data.error || 'فشل في تنظيف الجلسات المنتهية');
                }
            } catch (error) {
                console.error('Error cleaning up expired sessions:', error);
                showNotification('error', 'فشل في تنظيف الجلسات المنتهية');
            }
        }

        // تحكم في الجلسة
        function controlSession(sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (!session) return;

            document.getElementById('sessionControlId').value = sessionId;
            document.getElementById('sessionMaxDays').value = session.max_days || 30;
            document.getElementById('sessionDaysRemaining').value = session.days_remaining || 0;
            document.getElementById('sessionIsPaused').value = session.is_paused ? 'true' : 'false';
            document.getElementById('sessionPauseReason').value = session.pause_reason || '';

            // إظهار/إخفاء حقل سبب الإيقاف
            const pauseReasonGroup = document.getElementById('pauseReasonGroup');
            pauseReasonGroup.style.display = session.is_paused ? 'block' : 'none';

            // إظهار Modal
            const modal = document.getElementById('sessionControlModal');
            modal.style.display = 'block';
            modal.classList.add('show');
        }

        // تحديث إعدادات الجلسة
        async function updateSessionSettings() {
            const sessionId = document.getElementById('sessionControlId').value;
            const maxDays = parseInt(document.getElementById('sessionMaxDays').value);
            const daysRemaining = parseInt(document.getElementById('sessionDaysRemaining').value);
            const isPaused = document.getElementById('sessionIsPaused').value === 'true';
            const pauseReason = document.getElementById('sessionPauseReason').value;

            if (maxDays < 1 || maxDays > 9999) {
                showNotification('error', 'الحد الأقصى للأيام يجب أن يكون بين 1 و 9999');
                return;
            }

            if (daysRemaining < 0 || daysRemaining > maxDays) {
                showNotification('error', 'الأيام المتبقية يجب أن تكون بين 0 و ' + maxDays);
                return;
            }

            try {
                const response = await fetch(`/api/admin/sessions/${sessionId}/settings`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ maxDays, daysRemaining, isPaused, pauseReason })
                });

                const data = await response.json();
                if (data.success) {
                    closeModal('sessionControlModal');
                    showNotification('success', 'تم تحديث إعدادات الجلسة بنجاح');
                    loadSessions();
                } else {
                    showNotification('error', data.error || 'فشل في تحديث إعدادات الجلسة');
                }
            } catch (error) {
                console.error('Error updating session settings:', error);
                showNotification('error', 'فشل في تحديث إعدادات الجلسة');
            }
        }

        // تمديد الجلسة بسرعة
        async function extendSessionQuick(sessionId, days) {
            try {
                const response = await fetch(`/api/admin/sessions/${sessionId}/extend`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ days })
                });

                const data = await response.json();
                if (data.success) {
                    showNotification('success', `تم تمديد الجلسة بـ ${days} يوم`);
                    loadSessions();
                } else {
                    showNotification('error', data.error || 'فشل في تمديد الجلسة');
                }
            } catch (error) {
                console.error('Error extending session:', error);
                showNotification('error', 'فشل في تمديد الجلسة');
            }
        }

        // إيقاف/تفعيل الجلسة
        async function toggleSessionPause(sessionId, currentPauseStatus) {
            const isPaused = !currentPauseStatus;
            let pauseReason = '';

            if (isPaused) {
                pauseReason = prompt('أدخل سبب إيقاف الجلسة:');
                if (pauseReason === null) return; // المستخدم ألغى
            }

            try {
                const response = await fetch(`/api/admin/sessions/${sessionId}/toggle-pause`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ isPaused, pauseReason })
                });

                const data = await response.json();
                if (data.success) {
                    showNotification('success', data.message);
                    loadSessions();
                } else {
                    showNotification('error', data.error || 'فشل في تغيير حالة الجلسة');
                }
            } catch (error) {
                console.error('Error toggling session pause:', error);
                showNotification('error', 'فشل في تغيير حالة الجلسة');
            }
        }

        // تمديد الجلسة من Modal
        async function extendSession(days) {
            const sessionId = document.getElementById('sessionControlId').value;
            await extendSessionQuick(sessionId, days);
        }

        // إدارة حدود الجلسات
        function editUserLimits(userId, maxSessions, sessionTtlDays) {
            document.getElementById('editLimitsUserId').value = userId;
            document.getElementById('editMaxSessions').value = maxSessions;
            document.getElementById('editSessionTtlDays').value = sessionTtlDays;
            // إظهار Modal
            const modal = document.getElementById('editLimitsModal');
            modal.style.display = 'block';
            modal.classList.add('show');
        }

        async function updateUserLimits() {
            const userId = document.getElementById('editLimitsUserId').value;
            const maxSessions = parseInt(document.getElementById('editMaxSessions').value);
            const sessionTtlDays = parseInt(document.getElementById('editSessionTtlDays').value);

            if (!userId || !maxSessions || !sessionTtlDays) {
                showNotification('error', 'يرجى ملء جميع الحقول');
                return;
            }

            if (maxSessions < 1 || maxSessions > 100) {
                showNotification('error', 'عدد الجلسات يجب أن يكون بين 1 و 100');
                return;
            }

            if (sessionTtlDays < 1 || sessionTtlDays > 365) {
                showNotification('error', 'عدد أيام الجلسة يجب أن يكون بين 1 و 365');
                return;
            }

            try {
                const response = await fetch(`/api/admin/users/${userId}/limits`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ maxSessions, sessionTtlDays })
                });

                const data = await response.json();
                if (data.success) {
                    closeModal('editLimitsModal');
                    showNotification('success', 'تم تحديث حدود الجلسات بنجاح');
                    loadUsers();
                } else {
                    showNotification('error', data.error || 'فشل في تحديث حدود الجلسات');
                }
            } catch (error) {
                console.error('Error updating user limits:', error);
                showNotification('error', 'فشل في تحديث حدود الجلسات');
            }
        }

        function displayUsers() {
            const container = document.getElementById('usersList');
            
            if (users.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">لا توجد مستخدمين</p>';
                return;
            }

            let html = '';
            users.forEach(user => {
                const statusClass = user.is_admin ? 'status-admin' : 
                                  user.is_active ? 'status-active' : 'status-inactive';
                const statusText = user.is_admin ? 'أدمن' : 
                                 user.is_active ? 'نشط' : 'موقوف';

                html += `
                    <div class="user-card">
                        <div class="user-header">
                            <div class="user-info">
                                <h6>${user.username}</h6>
                                <p>${user.email}</p>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="user-status ${statusClass}">${statusText}</span>
                                <input type="checkbox" class="user-checkbox" value="${user.id}" onchange="toggleUserSelection(${user.id})">
                            </div>
                        </div>
                        
                        <div class="user-details">
                            <div class="detail-item">
                                <div class="detail-label">الجلسات المسموحة</div>
                                <div class="detail-value">${user.max_sessions || 1}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">أيام الجلسة</div>
                                <div class="detail-value">${user.session_ttl_days || 30} يوم</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">تاريخ الإنشاء</div>
                                <div class="detail-value">${new Date(user.created_at).toLocaleDateString('ar-SA')}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">آخر نشاط</div>
                                <div class="detail-value">${user.last_login ? new Date(user.last_login).toLocaleDateString('ar-SA') : 'لم يسجل دخول'}</div>
                            </div>
                        </div>
                        
                        <div class="user-actions">
                            <button class="btn btn-primary" onclick="editUser(${user.id})">
                                ✏️ تعديل
                            </button>
                            <button class="btn btn-warning" onclick="toggleUserStatus(${user.id})">
                                ${user.is_active ? '⏸️ إيقاف' : '▶️ تفعيل'}
                            </button>
                            <button class="btn btn-info" onclick="viewUserSessions(${user.id})">
                                📱 الجلسات
                            </button>
                            <button class="btn btn-secondary" onclick="editUserLimits(${user.id}, ${user.max_sessions || 1}, ${user.session_ttl_days || 30})">
                                ⚙️ حدود الجلسات
                            </button>
                            <button class="btn btn-danger" onclick="deleteUser(${user.id})">
                                🗑️ حذف
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        async function loadSessions() {
            try {
                const response = await fetch('/api/admin/sessions');
                const data = await response.json();
                if (data.success) {
                    sessions = data.sessions;
                    displaySessions();
                }
            } catch (error) {
                console.error('Error loading sessions:', error);
                showNotification('error', 'فشل في تحميل الجلسات');
            }
        }

        function displaySessions() {
            const container = document.getElementById('sessionsList');
            
            if (sessions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">لا توجد جلسات</p>';
                return;
            }

            let html = '';
            sessions.forEach(session => {
                // التحقق من انتهاء الصلاحية
                const isExpired = session.expires_at && new Date(session.expires_at) < new Date();
                const statusClass = session.status === 'connected' ? 'status-active' : 
                                  session.status === 'waiting_for_qr' ? 'status-warning' : 
                                  session.status === 'expired' || isExpired ? 'status-expired' : 'status-inactive';
                const statusText = session.status === 'connected' ? 'متصل' : 
                                 session.status === 'waiting_for_qr' ? 'انتظار QR' : 
                                 session.status === 'expired' || isExpired ? 'منتهي الصلاحية' : 'غير متصل';

                html += `
                    <div class="user-card">
                        <div class="user-header">
                            <div class="user-info">
                                <h6>${session.session_name}</h6>
                                <p>المستخدم: ${session.username}</p>
                            </div>
                            <span class="user-status ${statusClass}">${statusText}</span>
                        </div>
                        
                        <div class="user-details">
                            <div class="detail-item">
                                <div class="detail-label">معرف الجلسة</div>
                                <div class="detail-value">${session.id}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">تاريخ الإنشاء</div>
                                <div class="detail-value">${new Date(session.created_at).toLocaleDateString('ar-SA')}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">انتهاء الصلاحية</div>
                                <div class="detail-value ${isExpired ? 'text-danger' : ''}">${session.expires_at ? new Date(session.expires_at).toLocaleDateString('ar-SA') : 'غير محدد'}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">الأيام المتبقية</div>
                                <div class="detail-value ${session.days_remaining <= 3 ? 'text-warning' : ''}">${session.days_remaining || 0} يوم</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">الحد الأقصى للأيام</div>
                                <div class="detail-value">${session.max_days || 30} يوم</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">حالة الإيقاف</div>
                                <div class="detail-value">${session.is_paused ? '⏸️ معلقة' : '▶️ نشطة'}</div>
                            </div>
                            ${session.pause_reason ? `
                            <div class="detail-item">
                                <div class="detail-label">سبب الإيقاف</div>
                                <div class="detail-value">${session.pause_reason}</div>
                            </div>
                            ` : ''}
                        </div>
                        
                        <div class="user-actions">
                            <button class="btn btn-primary" onclick="viewSession(${session.id})">
                                👁️ عرض
                            </button>
                            <button class="btn btn-info" onclick="controlSession(${session.id})">
                                🎛️ تحكم
                            </button>
                            <button class="btn btn-success" onclick="extendSessionQuick(${session.id}, 7)">
                                +7 أيام
                            </button>
                            <button class="btn btn-success" onclick="extendSessionQuick(${session.id}, 30)">
                                +30 يوم
                            </button>
                            <button class="btn btn-success" onclick="extendSessionQuick(${session.id}, 365)">
                                +1 سنة
                            </button>
                            <button class="btn btn-warning" onclick="toggleSessionPause(${session.id}, ${session.is_paused})">
                                ${session.is_paused ? '▶️ تفعيل' : '⏸️ إيقاف'}
                            </button>
                            <button class="btn btn-danger" onclick="deleteSession(${session.id})">
                                🗑️ حذف
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        async function loadPackages() {
            try {
                const response = await fetch('/api/settings');
                const data = await response.json();
                if (data.success && data.packages) {
                    packages = data.packages;
                    displayPackages();
                }
            } catch (error) {
                console.error('Error loading packages:', error);
                showNotification('error', 'فشل في تحميل الباقات');
            }
        }

        function displayPackages() {
            const container = document.getElementById('packagesList');
            
            if (packages.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">لا توجد باقات</p>';
                return;
            }

            let html = '';
            packages.forEach(pkg => {
                html += `
                    <div class="user-card">
                        <div class="user-header">
                            <div class="user-info">
                                <h6>${pkg.name}</h6>
                                <p>معرف: ${pkg.id}</p>
                            </div>
                            <div style="font-size: 24px; font-weight: bold; color: #25D366;">
                                $${pkg.price}
                            </div>
                        </div>
                        
                        <div class="user-details">
                            <div class="detail-item">
                                <div class="detail-label">المدة</div>
                                <div class="detail-value">${pkg.durationDays} يوم</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">الحد الأقصى للجلسات</div>
                                <div class="detail-value">${pkg.maxSessions}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">المميزات</div>
                                <div class="detail-value">${pkg.features ? pkg.features.length : 0} ميزة</div>
                            </div>
                        </div>
                        
                        <div class="user-actions">
                            <button class="btn btn-primary" onclick="editPackage('${pkg.id}')">
                                ✏️ تعديل
                            </button>
                            <button class="btn btn-danger" onclick="deletePackage('${pkg.id}')">
                                🗑️ حذف
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        async function loadSettings() {
            try {
                const response = await fetch('/api/admin/settings');
                const data = await response.json();
                if (data.success) {
                    displaySettings(data.settings);
                }
            } catch (error) {
                console.error('Error loading settings:', error);
                showNotification('error', 'فشل في تحميل الإعدادات');
            }
        }

        function displaySettings(settings) {
            const container = document.getElementById('settingsContent');
            
            container.innerHTML = `
                <div class="user-card">
                    <h4>⚙️ إعدادات النظام العامة</h4>
                    <div class="user-details">
                        <div class="detail-item">
                            <div class="detail-label">رقم هاتف الأدمن</div>
                            <div class="detail-value">${settings.adminPhone || 'غير محدد'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">البريد الإلكتروني للأدمن</div>
                            <div class="detail-value">${settings.adminEmail || 'غير محدد'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">مدة الجلسة الافتراضية</div>
                            <div class="detail-value">${settings.defaultSessionTtl || 30} يوم</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">الحد الأقصى للجلسات الافتراضي</div>
                            <div class="detail-value">${settings.defaultMaxSessions || 1}</div>
                        </div>
                    </div>
                    <div class="user-actions">
                        <button class="btn btn-primary" onclick="editSettings()">
                            ✏️ تعديل الإعدادات
                        </button>
                    </div>
                </div>
            `;
        }

        async function loadStats() {
            try {
                const response = await fetch('/api/admin/stats');
                const data = await response.json();
                if (data.success) {
                    const stats = data.stats;
                    document.getElementById('totalUsers').textContent = stats.totalUsers || 0;
                    document.getElementById('activeUsers').textContent = stats.activeUsers || 0;
                    document.getElementById('totalSessions').textContent = stats.totalSessions || 0;
                    document.getElementById('totalSubscriptions').textContent = stats.totalSubscriptions || 0;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        async function loadUsers() {
            try {
                const response = await fetch('/api/admin/users');
                const data = await response.json();
                if (data.success) {
                    users = data.users;
                    displayUsers();
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        function displayUsers() {
            const container = document.getElementById('usersList');
            
            if (users.length === 0) {
                container.innerHTML = '<p class="text-center text-muted">لا توجد مستخدمين</p>';
                return;
            }

            let html = '';
            users.forEach(user => {
                const statusClass = user.is_admin ? 'status-admin' : 
                                  user.is_active ? 'status-active' : 'status-inactive';
                const statusText = user.is_admin ? 'أدمن' : 
                                 user.is_active ? 'نشط' : 'موقوف';

                html += `
                    <div class="user-card">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h6 class="mb-1">${user.username}</h6>
                                <p class="text-muted mb-2">${user.email}</p>
                                <div class="d-flex align-items-center gap-3">
                                    <span class="user-status ${statusClass}">${statusText}</span>
                                    <small class="text-muted">
                                        <i class="fas fa-users me-1"></i>
                                        ${user.max_sessions} جلسة
                                    </small>
                                    <small class="text-muted">
                                        <i class="fas fa-clock me-1"></i>
                                        ${user.session_ttl_days || 30} يوم
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-4 text-end">
                                <div class="btn-group" role="group">
                                    <button class="action-btn btn-edit" onclick="editUser(${user.id})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn btn-toggle" onclick="toggleUserStatus(${user.id})">
                                        <i class="fas fa-${user.is_active ? 'ban' : 'check'}"></i>
                                    </button>
                                    <button class="action-btn btn-delete" onclick="deleteUser(${user.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        async function loadPackages() {
            try {
                const response = await fetch('/api/settings');
                const data = await response.json();
                if (data.success && data.packages) {
                    packages = data.packages;
                    displayPackages();
                }
            } catch (error) {
                console.error('Error loading packages:', error);
            }
        }

        function displayPackages() {
            const container = document.getElementById('packagesList');
            
            if (packages.length === 0) {
                container.innerHTML = '<p class="text-center text-muted">لا توجد باقات</p>';
                return;
            }

            let html = '';
            packages.forEach(pkg => {
                html += `
                    <div class="package-card">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h6 class="mb-1">${pkg.name}</h6>
                                <div class="package-price">$${pkg.price} USD</div>
                                <ul class="feature-list">
                                    ${pkg.features.map(feature => `<li>${feature}</li>`).join('')}
                                </ul>
                                <small class="text-muted">
                                    <i class="fas fa-clock me-1"></i>
                                    ${pkg.durationDays} يوم
                                </small>
                            </div>
                            <div class="col-md-4 text-end">
                                <div class="btn-group" role="group">
                                    <button class="action-btn btn-edit" onclick="editPackage('${pkg.id}')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn btn-delete" onclick="deletePackage('${pkg.id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        async function loadSubscriptions() {
            try {
                const response = await fetch('/api/admin/subscriptions');
                const data = await response.json();
                if (data.success) {
                    subscriptions = data.subscriptions;
                    displaySubscriptions();
                }
            } catch (error) {
                console.error('Error loading subscriptions:', error);
            }
        }

        function displaySubscriptions() {
            const container = document.getElementById('subscriptionsList');
            
            if (subscriptions.length === 0) {
                container.innerHTML = '<p class="text-center text-muted">لا توجد اشتراكات</p>';
                return;
            }

            let html = `
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>المستخدم</th>
                                <th>الباقة</th>
                                <th>السعر</th>
                                <th>تاريخ البداية</th>
                                <th>تاريخ الانتهاء</th>
                                <th>الحالة</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            subscriptions.forEach(sub => {
                const startDate = new Date(sub.startDate).toLocaleDateString('ar-SA');
                const endDate = new Date(sub.endDate).toLocaleDateString('ar-SA');
                const statusClass = sub.status === 'active' ? 'badge bg-success' : 'badge bg-danger';
                const statusText = sub.status === 'active' ? 'نشط' : 'منتهي';

                html += `
                    <tr>
                        <td>${sub.username}</td>
                        <td>${sub.packageName}</td>
                        <td>$${sub.price} ${sub.currency}</td>
                        <td>${startDate}</td>
                        <td>${endDate}</td>
                        <td><span class="${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline-danger" onclick="cancelSubscription(${sub.id})">
                                <i class="fas fa-times"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                </div>
            `;

            container.innerHTML = html;
        }


        function showAddPackageModal() {
            const modal = new bootstrap.Modal(document.getElementById('addPackageModal'));
            modal.show();
        }

        async function addUser() {
            const username = document.getElementById('newUsername').value.trim();
            const email = document.getElementById('newEmail').value.trim();
            const password = document.getElementById('newPassword').value;
            const maxSessions = parseInt(document.getElementById('newMaxSessions').value);
            const isAdmin = document.getElementById('newIsAdmin').checked;

            if (!username || !email || !password) {
                showErrorMessage('يرجى ملء جميع الحقول المطلوبة');
                return;
            }

            try {
                const response = await fetch('/api/admin/users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username,
                        email,
                        password,
                        maxSessions,
                        isAdmin
                    })
                });

                const data = await response.json();
                if (data.success) {
                    bootstrap.Modal.getInstance(document.getElementById('addUserModal')).hide();
                    showSuccessMessage('تم إضافة المستخدم بنجاح');
                    loadUsers();
                    loadStats();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error adding user:', error);
                showErrorMessage('فشل في إضافة المستخدم');
            }
        }

        async function addPackage() {
            const id = document.getElementById('packageId').value.trim();
            const name = document.getElementById('packageName').value.trim();
            const price = parseFloat(document.getElementById('packagePrice').value);
            const durationDays = parseInt(document.getElementById('packageDuration').value);
            const maxSessions = parseInt(document.getElementById('packageMaxSessions').value);
            const features = document.getElementById('packageFeatures').value.split('\n').filter(f => f.trim());

            if (!id || !name || !price || !durationDays || !maxSessions) {
                showErrorMessage('يرجى ملء جميع الحقول المطلوبة');
                return;
            }

            try {
                const response = await fetch('/api/admin/packages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id,
                        name,
                        price,
                        durationDays,
                        maxSessions,
                        features
                    })
                });

                const data = await response.json();
                if (data.success) {
                    bootstrap.Modal.getInstance(document.getElementById('addPackageModal')).hide();
                    showSuccessMessage('تم إضافة الباقة بنجاح');
                    loadPackages();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error adding package:', error);
                showErrorMessage('فشل في إضافة الباقة');
            }
        }

        async function toggleUserStatus(userId) {
            try {
                const response = await fetch(`/api/admin/users/${userId}/toggle`, {
                    method: 'POST'
                });

                const data = await response.json();
                if (data.success) {
                    showSuccessMessage('تم تحديث حالة المستخدم بنجاح');
                    loadUsers();
                    loadStats();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error toggling user status:', error);
                showErrorMessage('فشل في تحديث حالة المستخدم');
            }
        }

        async function deleteUser(userId) {
            if (!confirm('هل أنت متأكد من حذف هذا المستخدم؟')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/users/${userId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                if (data.success) {
                    showSuccessMessage('تم حذف المستخدم بنجاح');
                    loadUsers();
                    loadStats();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                showErrorMessage('فشل في حذف المستخدم');
            }
        }

        function editUser(userId) {
            // Implement edit user functionality
            showInfoMessage('ميزة تعديل المستخدم قيد التطوير');
        }

        function editPackage(packageId) {
            // Implement edit package functionality
            showInfoMessage('ميزة تعديل الباقة قيد التطوير');
        }

        async function deletePackage(packageId) {
            if (!confirm('هل أنت متأكد من حذف هذه الباقة؟')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/packages/${packageId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                if (data.success) {
                    showSuccessMessage('تم حذف الباقة بنجاح');
                    loadPackages();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error deleting package:', error);
                showErrorMessage('فشل في حذف الباقة');
            }
        }

        async function cancelSubscription(subscriptionId) {
            if (!confirm('هل أنت متأكد من إلغاء هذا الاشتراك؟')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/subscriptions/${subscriptionId}/cancel`, {
                    method: 'POST'
                });

                const data = await response.json();
                if (data.success) {
                    showSuccessMessage('تم إلغاء الاشتراك بنجاح');
                    loadSubscriptions();
                    loadStats();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error canceling subscription:', error);
                showErrorMessage('فشل في إلغاء الاشتراك');
            }
        }

        function showSuccessMessage(message) {
            const notification = document.createElement('div');
            notification.className = 'alert alert-success alert-dismissible fade show position-fixed';
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <i class="fas fa-check-circle me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function showErrorMessage(message) {
            const notification = document.createElement('div');
            notification.className = 'alert alert-danger alert-dismissible fade show position-fixed';
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <i class="fas fa-exclamation-circle me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function showInfoMessage(message) {
            const notification = document.createElement('div');
            notification.className = 'alert alert-info alert-dismissible fade show position-fixed';
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <i class="fas fa-info-circle me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function logout() {
            fetch('/logout')
                .then(() => {
                    window.location.href = '/';
                })
                .catch(error => {
                    console.error('Logout error:', error);
                    window.location.href = '/';
                });
        }
    </script>
</body>
</html>


