<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - ÙˆØ§ØªØ³Ø§Ø¨ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Ø¯Ø¹Ù… ÙƒØ§Ù…Ù„ Ù„Ù„Ø¹Ø±Ø¨ÙŠØ© */
        body {
            direction: rtl;
            text-align: right;
            font-family: 'Segoe UI', 'Tahoma', 'Arial', sans-serif;
        }

        .ltr {
            direction: ltr;
            text-align: left;
        }

        .language-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .language-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        body {
            background: #f5f5f5;
            min-height: 100vh;
        }

        /* Improvements CSS */
        @import url('css/improvements.css');

        .navbar {
            background: #25D366;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar h1 {
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .navbar h1::before {
            content: "âš™ï¸";
            font-size: 28px;
        }

        .navbar .nav-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .header-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .header-section h2 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #25D366;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
            color: #666;
        }

        .tab-button.active {
            background: #25D366;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .content-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .user-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .user-card:hover {
            border-color: #25D366;
            box-shadow: 0 3px 10px rgba(37, 211, 102, 0.1);
        }

        .user-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .user-info h6 {
            color: #333;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .user-info p {
            color: #666;
            margin: 0;
        }

        .user-status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status-admin {
            background: #cce5ff;
            color: #004085;
        }

        .status-expired {
            background: #f8d7da;
            color: #721c24;
        }

        .user-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            text-align: center;
        }

        .detail-label {
            color: #666;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .detail-value {
            color: #333;
            font-weight: 600;
        }

        .user-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background: #25D366;
            color: white;
        }

        .btn-primary:hover {
            background: #128C7E;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            background: #25D366;
            color: white;
            padding: 20px 30px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 20px;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            background: none;
        }

        .close:hover {
            opacity: 0.7;
        }

        .modal-body {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 12px;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #25D366;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .modal-footer {
            padding: 20px 30px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            z-index: 9999;
            min-width: 300px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.warning {
            background: #ffc107;
            color: #333;
        }

        .notification.info {
            background: #17a2b8;
        }

        .bulk-actions {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .bulk-actions.show {
            display: block;
        }

        .search-box {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .search-box:focus {
            outline: none;
            border-color: #25D366;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #25D366;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .user-details {
                grid-template-columns: 1fr;
            }
            
            .user-actions {
                justify-content: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .text-danger {
            color: #dc3545 !important;
        }

        .text-warning {
            color: #ffc107 !important;
        }

        .btn-group {
            display: flex;
            gap: 5px;
        }

        .btn-group .btn {
            flex: 1;
        }
    </style>
    <!-- Improvements CSS -->
    <link rel="stylesheet" href="css/improvements.css">
</head>
<body>
    <nav class="navbar">
        <h1>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>
        <div class="nav-actions">
            <button class="language-toggle" onclick="toggleLanguage()" id="languageToggle">English</button>
            <a href="/dashboard" class="back-btn">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <button class="back-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
    </nav>

    <div class="container">
        <!-- Header -->
        <div class="header-section">
            <h2>âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</h2>
            <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø¬Ù„Ø³Ø§Øª ÙˆØ§Ù„Ù†Ø¸Ø§Ù…</p>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalUsers">0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="activeUsers">0</div>
                <div class="stat-label">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalSessions">0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¬Ù„Ø³Ø§Øª</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="connectedSessions">0</div>
                <div class="stat-label">Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…ØªØµÙ„Ø©</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalMessages">0</div>
                <div class="stat-label">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø©</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="apiCalls">0</div>
                <div class="stat-label">Ø§Ø³ØªØ¯Ø¹Ø§Ø¡Ø§Øª API</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('users')">
                ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            </button>
            <button class="tab-button" onclick="switchTab('sessions')">
                ğŸ“± Ø§Ù„Ø¬Ù„Ø³Ø§Øª
            </button>
            <button class="tab-button" onclick="switchTab('packages')">
                ğŸ“¦ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
            </button>
            <button class="tab-button" onclick="switchTab('settings')">
                âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
        </div>

        <!-- Users Tab -->
        <div id="users-tab" class="tab-content active">
            <div class="content-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
                    <div>
                        <button class="btn btn-primary" onclick="showAddUserModal()">
                            â• Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…
                        </button>
                        <button class="btn btn-secondary" onclick="toggleBulkActions()">
                            ğŸ“‹ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¬Ù…Ø§Ø¹ÙŠØ©
                        </button>
                    </div>
                </div>
                
                <!-- Filters and Search -->
                <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;">
                    <input type="text" class="search-box" id="userSearch" placeholder="ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†..." onkeyup="searchUsers()" style="flex: 1; min-width: 200px;">
                    <select id="userStatusFilter" class="search-box" onchange="filterUsers()" style="width: 150px;">
                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                        <option value="active">Ù†Ø´Ø·</option>
                        <option value="inactive">Ù…ÙˆÙ‚ÙˆÙ</option>
                        <option value="admin">Ø£Ø¯Ù…Ù†</option>
                    </select>
                    <select id="userSortBy" class="search-box" onchange="sortUsers()" style="width: 150px;">
                        <option value="name">Ø§Ù„Ø§Ø³Ù…</option>
                        <option value="created">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</option>
                        <option value="sessions">Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø§Øª</option>
                        <option value="last_activity">Ø¢Ø®Ø± Ù†Ø´Ø§Ø·</option>
                    </select>
                    <button class="btn btn-info" onclick="exportUsersData()" title="ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª">
                        ğŸ“¥ ØªØµØ¯ÙŠØ±
                    </button>
                    <button class="btn btn-secondary" onclick="refreshUsers()" title="ØªØ­Ø¯ÙŠØ«">
                        ğŸ”„ ØªØ­Ø¯ÙŠØ«
                    </button>
                </div>
                
                <div class="bulk-actions" id="bulkActions">
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span>Ø§Ù„Ù…Ø­Ø¯Ø¯: <span id="selectedCount">0</span></span>
                        <button class="btn btn-warning" onclick="bulkToggleStatus()">ØªÙØ¹ÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù</button>
                        <button class="btn btn-info" onclick="bulkUpdateSessions()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ù„Ø³Ø§Øª</button>
                        <button class="btn btn-danger" onclick="bulkDelete()">Ø­Ø°Ù</button>
                        <button class="btn btn-secondary" onclick="clearSelection()">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯</button>
                    </div>
                </div>
                
                <div id="usersList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sessions Tab -->
        <div id="sessions-tab" class="tab-content">
            <div class="content-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>ğŸ“± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª</h3>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-warning" onclick="cleanupExpiredSessions()">
                            ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©
                        </button>
                        <button class="btn btn-info" onclick="exportSessionsData()" title="ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª">
                            ğŸ“¥ ØªØµØ¯ÙŠØ±
                        </button>
                        <button class="btn btn-secondary" onclick="refreshSessions()" title="ØªØ­Ø¯ÙŠØ«">
                            ğŸ”„ ØªØ­Ø¯ÙŠØ«
                        </button>
                    </div>
                </div>
                
                <!-- Filters and Search for Sessions -->
                <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;">
                    <input type="text" class="search-box" id="sessionSearch" placeholder="ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø§Øª..." onkeyup="searchSessions()" style="flex: 1; min-width: 200px;">
                    <select id="sessionStatusFilter" class="search-box" onchange="filterSessions()" style="width: 150px;">
                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                        <option value="connected">Ù…ØªØµÙ„</option>
                        <option value="disconnected">ØºÙŠØ± Ù…ØªØµÙ„</option>
                        <option value="waiting_for_qr">Ø§Ù†ØªØ¸Ø§Ø± QR</option>
                        <option value="expired">Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</option>
                    </select>
                    <select id="sessionSortBy" class="search-box" onchange="sortSessions()" style="width: 150px;">
                        <option value="name">Ø§Ù„Ø§Ø³Ù…</option>
                        <option value="created">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</option>
                        <option value="expires">Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</option>
                        <option value="status">Ø§Ù„Ø­Ø§Ù„Ø©</option>
                    </select>
                    <select id="sessionUserFilter" class="search-box" onchange="filterSessions()" style="width: 150px;">
                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</option>
                    </select>
                </div>
                
                <div id="sessionsList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Packages Tab -->
        <div id="packages-tab" class="tab-content">
            <div class="content-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</h3>
                    <button class="btn btn-primary" onclick="showAddPackageModal()">
                        â• Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù‚Ø©
                    </button>
                </div>
                <div id="packagesList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
            <div class="content-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                    <a href="/limits.html" class="btn btn-info" target="_blank">
                        ğŸ“Š Ø¹Ø±Ø¶ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù†Ø¸Ø§Ù…
                    </a>
                </div>
                <div id="settingsContent">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>â• Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h3>
                <button class="close" onclick="closeModal('addUserModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label for="newUsername">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                        <input type="text" id="newUsername" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required>
                    </div>
                    <div class="form-group">
                        <label for="newEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="newEmail" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="newPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newMaxSessions">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø¬Ù„Ø³Ø§Øª</label>
                            <input type="number" id="newMaxSessions" placeholder="1" value="1" min="1" max="10" required>
                        </div>
                        <div class="form-group">
                            <label for="newSessionDays">Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ù„ÙƒÙ„ Ø¬Ù„Ø³Ø©</label>
                            <input type="number" id="newSessionDays" placeholder="30" value="30" min="1" max="365" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="newIsAdmin" style="width: auto;">
                            ØµÙ„Ø§Ø­ÙŠØ§Øª Ø£Ø¯Ù…Ù†
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addUserModal')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="addUser()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
            </div>
        </div>
    </div>

    <!-- Edit User Limits Modal -->
    <div id="editLimitsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>âš™ï¸ ØªØ¹Ø¯ÙŠÙ„ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¬Ù„Ø³Ø§Øª</h3>
                <button class="close" onclick="closeModal('editLimitsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editLimitsForm">
                    <input type="hidden" id="editLimitsUserId">
                    <div class="form-group">
                        <label for="editMaxSessions">Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©</label>
                        <input type="number" id="editMaxSessions" min="1" max="1000" required>
                        <small>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: 1 Ø¬Ù„Ø³Ø© | Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 1000 Ø¬Ù„Ø³Ø©</small>
                    </div>
                    <div class="form-group">
                        <label for="editSessionTtlDays">Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© (Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯)</label>
                        <input type="number" id="editSessionTtlDays" min="1" max="9999" required>
                        <small>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: 1 ÙŠÙˆÙ… | Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 9999 ÙŠÙˆÙ… (Ø£ÙƒØ«Ø± Ù…Ù† 27 Ø³Ù†Ø©)</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editLimitsModal')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="updateUserLimits()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
            </div>
        </div>
    </div>

    <!-- Session Control Modal -->
    <div id="sessionControlModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>ğŸ›ï¸ ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø©</h3>
                <button class="close" onclick="closeModal('sessionControlModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="sessionControlForm">
                    <input type="hidden" id="sessionControlId">
                    <div class="form-group">
                        <label for="sessionMaxDays">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø£ÙŠØ§Ù…</label>
                        <input type="number" id="sessionMaxDays" min="1" max="9999" required>
                        <small class="form-text">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 9999 ÙŠÙˆÙ… (Ø£ÙƒØ«Ø± Ù…Ù† 27 Ø³Ù†Ø©!)</small>
                    </div>
                    <div class="form-group">
                        <label for="sessionDaysRemaining">Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</label>
                        <input type="number" id="sessionDaysRemaining" min="0" max="9999" required>
                        <small class="form-text">Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù„Ù„Ø¬Ù„Ø³Ø©</small>
                    </div>
                    <div class="form-group">
                        <label for="sessionIsPaused">Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø©</label>
                        <select id="sessionIsPaused" class="form-control" onchange="togglePauseReason()">
                            <option value="false">Ù†Ø´Ø·Ø©</option>
                            <option value="true">Ù…Ø¹Ù„Ù‚Ø©</option>
                        </select>
                        <small>ÙŠÙ…ÙƒÙ† Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¬Ù„Ø³Ø© Ù…Ø¤Ù‚ØªØ§Ù‹ Ø¨Ø¯ÙˆÙ† Ø­Ø°ÙÙ‡Ø§</small>
                    </div>
                    <div class="form-group" id="pauseReasonGroup" style="display: none;">
                        <label for="sessionPauseReason">Ø³Ø¨Ø¨ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù</label>
                        <input type="text" id="sessionPauseReason" placeholder="Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¬Ù„Ø³Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                        <small>ÙŠØªÙ… Ø¹Ø±Ø¶ Ø³Ø¨Ø¨ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</small>
                    </div>
                    <div class="form-group">
                        <label>ØªØ­Ø¯ÙŠØ« Ø³Ø±ÙŠØ¹</label>
                        <div class="btn-group" style="width: 100%;">
                            <button type="button" class="btn btn-success" onclick="extendSession(7)">+7 Ø£ÙŠØ§Ù…</button>
                            <button type="button" class="btn btn-success" onclick="extendSession(30)">+30 ÙŠÙˆÙ…</button>
                            <button type="button" class="btn btn-success" onclick="extendSession(90)">+90 ÙŠÙˆÙ…</button>
                            <button type="button" class="btn btn-success" onclick="extendSession(365)">+1 Ø³Ù†Ø©</button>
                            <button type="button" class="btn btn-success" onclick="extendSession(1095)">+3 Ø³Ù†ÙˆØ§Øª</button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('sessionControlModal')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="updateSessionSettings()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
            </div>
        </div>
    </div>

    <!-- System Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
                <button class="close" onclick="closeModal('settingsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="settingsForm">
                    <div class="form-group">
                        <label for="adminPhone">Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</label>
                        <input type="tel" id="adminPhone" placeholder="+966xxxxxxxxx">
                        <small class="form-text">Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</small>
                    </div>
                    <div class="form-group">
                        <label for="defaultMaxSessions">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø¬Ù„Ø³Ø§Øª</label>
                        <input type="number" id="defaultMaxSessions" min="1" max="1000" value="5">
                        <small class="form-text">Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 1000)</small>
                    </div>
                    <div class="form-group">
                        <label for="defaultSessionDays">Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</label>
                        <input type="number" id="defaultSessionDays" min="1" max="9999" value="30">
                        <small class="form-text">Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('settingsModal')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="updateSettings()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            </div>
        </div>
    </div>

    <!-- Add Package Modal -->
    <div id="addPackageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“¦ Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <button class="close" onclick="closeModal('addPackageModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addPackageForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="packageId">Ù…Ø¹Ø±Ù Ø§Ù„Ø¨Ø§Ù‚Ø©</label>
                            <input type="text" id="packageId" placeholder="Ù…Ø«Ø§Ù„: basic, premium, pro" required>
                        </div>
                        <div class="form-group">
                            <label for="packageName">Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ù‚Ø©</label>
                            <input type="text" id="packageName" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="packagePrice">Ø§Ù„Ø³Ø¹Ø± (USD)</label>
                            <input type="number" id="packagePrice" placeholder="0.00" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="packageDuration">Ø§Ù„Ù…Ø¯Ø© Ø¨Ø§Ù„Ø£ÙŠØ§Ù…</label>
                            <input type="number" id="packageDuration" placeholder="30" min="1" max="365" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="packageMaxSessions">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø¬Ù„Ø³Ø§Øª</label>
                        <input type="number" id="packageMaxSessions" placeholder="1" min="1" max="10" required>
                    </div>
                    <div class="form-group">
                        <label for="packageFeatures">Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª (Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ Ù„ÙƒÙ„ Ù…ÙŠØ²Ø©)</label>
                        <textarea id="packageFeatures" placeholder="Ù…Ø«Ø§Ù„:&#10;Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯&#10;Ø¯Ø¹Ù… Ø§Ù„Ù…Ù„ÙØ§Øª&#10;API Ù…ØªÙ‚Ø¯Ù…" style="height: 100px"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addPackageModal')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="addPackage()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø©</button>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="editUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
                <button class="close" onclick="closeModal('editUserModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editUserForm">
                    <input type="hidden" id="editUserId">
                    <div class="form-group">
                        <label for="editUsername">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                        <input type="text" id="editUsername" required>
                    </div>
                    <div class="form-group">
                        <label for="editEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="editEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="editPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø§ØªØ±ÙƒÙ‡Ø§ ÙØ§Ø±ØºØ© Ù„Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø­Ø§Ù„ÙŠØ©)</label>
                        <input type="password" id="editPassword">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editMaxSessions">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø¬Ù„Ø³Ø§Øª</label>
                            <input type="number" id="editMaxSessions" min="1" max="10" required>
                        </div>
                        <div class="form-group">
                            <label for="editSessionDays">Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ù„ÙƒÙ„ Ø¬Ù„Ø³Ø©</label>
                            <input type="number" id="editSessionDays" min="1" max="365" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="editIsAdmin" style="width: auto;">
                            ØµÙ„Ø§Ø­ÙŠØ§Øª Ø£Ø¯Ù…Ù†
                        </label>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="editIsActive" style="width: auto;">
                            Ø§Ù„Ø­Ø³Ø§Ø¨ Ù†Ø´Ø·
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editUserModal')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="updateUser()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let users = [];
        let packages = [];
        let subscriptions = [];
        let sessions = [];
        let selectedUsers = new Set();
        let currentTab = 'users';
        let currentLanguage = 'ar'; // Ø§Ù„Ù„ØºØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©

        // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ Ù…Ø¹ Ø§Ù„Ù…Ø¯Ø©
        function formatDate(dateString, includeTime = false) {
            if (!dateString) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return 'ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ­ÙŠØ­';
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… en-US Ù…Ø¹ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠØŒ Ø«Ù… ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø£Ø´Ù‡Ø± Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©
            const options = {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                calendar: 'gregory' // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ
            };
            
            if (includeTime) {
                options.hour = '2-digit';
                options.minute = '2-digit';
            }
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… en-US Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ
            const day = date.getDate();
            const month = date.getMonth();
            const year = date.getFullYear();
            
            // ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø£Ø´Ù‡Ø± Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©
            const monthNames = [
                'ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ',
                'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'
            ];
            
            let formatted = `${day} ${monthNames[month]} ${year}`;
            
            if (includeTime) {
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                formatted += ` ${hours}:${minutes}`;
            }
            
            return formatted;
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø© (Ù…Ù†Ø° Ù…ØªÙ‰)
        function getTimeAgo(dateString) {
            if (!dateString) return '';
            
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return '';
            
            const now = new Date();
            const diffMs = now - date;
            const diffSeconds = Math.floor(diffMs / 1000);
            const diffMinutes = Math.floor(diffSeconds / 60);
            const diffHours = Math.floor(diffMinutes / 60);
            const diffDays = Math.floor(diffHours / 24);
            const diffMonths = Math.floor(diffDays / 30);
            const diffYears = Math.floor(diffDays / 365);
            
            if (diffYears > 0) {
                return `Ù…Ù†Ø° ${diffYears} ${diffYears === 1 ? 'Ø³Ù†Ø©' : 'Ø³Ù†Ø©'}`;
            } else if (diffMonths > 0) {
                return `Ù…Ù†Ø° ${diffMonths} ${diffMonths === 1 ? 'Ø´Ù‡Ø±' : 'Ø£Ø´Ù‡Ø±'}`;
            } else if (diffDays > 0) {
                return `Ù…Ù†Ø° ${diffDays} ${diffDays === 1 ? 'ÙŠÙˆÙ…' : 'Ø£ÙŠØ§Ù…'}`;
            } else if (diffHours > 0) {
                return `Ù…Ù†Ø° ${diffHours} ${diffHours === 1 ? 'Ø³Ø§Ø¹Ø©' : 'Ø³Ø§Ø¹Ø§Øª'}`;
            } else if (diffMinutes > 0) {
                return `Ù…Ù†Ø° ${diffMinutes} ${diffMinutes === 1 ? 'Ø¯Ù‚ÙŠÙ‚Ø©' : 'Ø¯Ù‚Ø§Ø¦Ù‚'}`;
            } else {
                return 'Ø§Ù„Ø¢Ù†';
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ø¹ Ø§Ù„Ù…Ø¯Ø©
        function formatDateWithAgo(dateString, includeTime = false) {
            const formatted = formatDate(dateString, includeTime);
            const ago = getTimeAgo(dateString);
            return ago ? `${formatted} (${ago})` : formatted;
        }

        // ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù†ØµÙˆØµ
        const translations = {
            ar: {
                title: 'Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©',
                backToHome: 'â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
                logout: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬',
                english: 'English',
                adminPanel: 'Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†',
                adminPanelDesc: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø¬Ù„Ø³Ø§Øª ÙˆØ§Ù„Ù†Ø¸Ø§Ù…',
                users: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†',
                sessions: 'Ø§Ù„Ø¬Ù„Ø³Ø§Øª',
                packages: 'Ø§Ù„Ø¨Ø§Ù‚Ø§Øª',
                settings: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',
                addUser: 'Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…',
                bulkActions: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¬Ù…Ø§Ø¹ÙŠØ©',
                addPackage: 'Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù‚Ø©',
                cleanupExpired: 'ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©',
                editLimits: 'Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¬Ù„Ø³Ø§Øª',
                edit: 'ØªØ¹Ø¯ÙŠÙ„',
                pause: 'Ø¥ÙŠÙ‚Ø§Ù',
                resume: 'ØªÙØ¹ÙŠÙ„',
                sessions: 'Ø§Ù„Ø¬Ù„Ø³Ø§Øª',
                delete: 'Ø­Ø°Ù',
                view: 'Ø¹Ø±Ø¶',
                restart: 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„',
                created: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡',
                lastUpdated: 'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«',
                expires: 'Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©',
                expired: 'Ù…Ù†ØªÙ‡ÙŠØ©',
                daysRemaining: 'ÙŠÙˆÙ… Ù…ØªØ¨Ù‚ÙŠ',
                confirmDelete: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±ØŸ',
                confirmCleanup: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©ØŸ'
            },
            en: {
                title: 'Admin Panel',
                backToHome: 'â† Back to Home',
                logout: 'Logout',
                english: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©',
                adminPanel: 'Admin Panel',
                adminPanelDesc: 'Manage users, sessions and system',
                users: 'Users',
                sessions: 'Sessions',
                packages: 'Packages',
                settings: 'Settings',
                addUser: 'Add User',
                bulkActions: 'Bulk Actions',
                addPackage: 'Add Package',
                cleanupExpired: 'Cleanup Expired Sessions',
                editLimits: 'Session Limits',
                edit: 'Edit',
                pause: 'Pause',
                resume: 'Resume',
                sessions: 'Sessions',
                delete: 'Delete',
                view: 'View',
                restart: 'Restart',
                created: 'Created',
                lastUpdated: 'Last Updated',
                expires: 'Expires',
                expired: 'Expired',
                daysRemaining: 'days remaining',
                confirmDelete: 'Are you sure you want to delete this item?',
                confirmCleanup: 'Are you sure you want to cleanup expired sessions?'
            }
        };

        // ÙˆØ¸ÙŠÙØ© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
            document.documentElement.lang = currentLanguage;
            document.documentElement.dir = currentLanguage === 'ar' ? 'rtl' : 'ltr';
            updateLanguage();
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ©
        function updateLanguage() {
            const t = translations[currentLanguage];
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            document.querySelector('h1').textContent = t.title;
            
            // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ù„ØºØ©
            document.getElementById('languageToggle').textContent = t.english;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
            document.querySelector('a[href="/dashboard"]').textContent = t.backToHome;
            document.querySelector('button[onclick="logout()"]').textContent = t.logout;
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            loadStats();
            loadUsers();
            loadSessions();
        }

        // Load data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadUserInfo();
            loadStats();
            loadUsers();
            loadSessions();
            loadPackages();
            loadSettings();
        });

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            
            currentTab = tabName;

            // Load data for the tab
            switch(tabName) {
                case 'users':
                    loadUsers();
                    break;
                case 'sessions':
                    loadSessions();
                    break;
                case 'packages':
                    loadPackages();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }

        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
            modal.classList.remove('show');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        async function loadUserInfo() {
            try {
                const response = await fetch('/api/me');
                const data = await response.json();
                if (data.success) {
                    currentUser = data.user;
                    if (!currentUser.isAdmin) {
                        window.location.href = '/dashboard';
                    }
                }
            } catch (error) {
                console.error('Error loading user info:', error);
                window.location.href = '/dashboard';
            }
        }

        // User management functions
        function showAddUserModal() {
            document.getElementById('addUserForm').reset();
            // Ø¥Ø¸Ù‡Ø§Ø± Modal
            const modal = document.getElementById('addUserModal');
            modal.style.display = 'block';
            modal.classList.add('show');
        }

        function showAddPackageModal() {
            document.getElementById('addPackageForm').reset();
            showModal('addPackageModal');
        }

        async function addUser() {
            const username = document.getElementById('newUsername').value.trim();
            const email = document.getElementById('newEmail').value.trim();
            const password = document.getElementById('newPassword').value;
            const maxSessions = parseInt(document.getElementById('newMaxSessions').value);
            const sessionDays = parseInt(document.getElementById('newSessionDays').value);
            const isAdmin = document.getElementById('newIsAdmin').checked;

            if (!username || !email || !password) {
                showNotification('error', 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }

            try {
                const response = await fetch('/api/admin/users', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username, email, password, maxSessions, sessionDays, isAdmin
                    })
                });

                const data = await response.json();
                if (data.success) {
                    closeModal('addUserModal');
                    showNotification('success', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                    loadUsers();
                    loadStats();
                } else {
                    showNotification('error', data.error || 'ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                }
            } catch (error) {
                console.error('Error adding user:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        // Notification system
        function showNotification(type, message) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                ${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'} ${message}
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 5000);
        }

        async function logout() {
            try {
                const response = await fetch('/api/logout', {
                    method: 'POST'
                });
                
                if (response.ok) {
                    window.location.href = '/';
                }
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = '/';
            }
        }

        async function loadUsers() {
            try {
                const response = await fetch('/api/admin/users');
                const data = await response.json();
                if (data.success) {
                    users = data.users;
                    displayUsers();
                }
            } catch (error) {
                console.error('Error loading users:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†');
            }
        }

        async function loadStats() {
            try {
                const response = await fetch('/api/admin/stats');
                const data = await response.json();
                if (data.success) {
                    const stats = data.stats;
                    document.getElementById('totalUsers').textContent = stats.totalUsers || 0;
                    document.getElementById('activeUsers').textContent = stats.activeUsers || 0;
                    document.getElementById('totalSessions').textContent = stats.totalSessions || 0;
                    document.getElementById('connectedSessions').textContent = stats.connectedSessions || 0;
                    document.getElementById('totalMessages').textContent = stats.totalMessages || 0;
                    document.getElementById('apiCalls').textContent = stats.apiCalls || 0;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Additional functions
        function editUser(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;

            document.getElementById('editUserId').value = user.id;
            document.getElementById('editUsername').value = user.username;
            document.getElementById('editEmail').value = user.email;
            document.getElementById('editMaxSessions').value = user.max_sessions || 1;
            document.getElementById('editSessionDays').value = user.session_ttl_days || 30;
            document.getElementById('editIsAdmin').checked = user.is_admin || false;
            document.getElementById('editIsActive').checked = user.is_active || false;

            showModal('editUserModal');
        }

        async function updateUser() {
            const userId = document.getElementById('editUserId').value;
            const username = document.getElementById('editUsername').value.trim();
            const email = document.getElementById('editEmail').value.trim();
            const password = document.getElementById('editPassword').value;
            const maxSessions = parseInt(document.getElementById('editMaxSessions').value);
            const sessionDays = parseInt(document.getElementById('editSessionDays').value);
            const isAdmin = document.getElementById('editIsAdmin').checked;
            const isActive = document.getElementById('editIsActive').checked;

            if (!username || !email) {
                showNotification('error', 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }

            try {
                const response = await fetch(`/api/admin/users/${userId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username, email, password, maxSessions, sessionDays, isAdmin, isActive
                    })
                });

                const data = await response.json();
                if (data.success) {
                    closeModal('editUserModal');
                    showNotification('success', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                    loadUsers();
                    loadStats();
                } else {
                    showNotification('error', data.error || 'ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                }
            } catch (error) {
                console.error('Error updating user:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        async function toggleUserStatus(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) {
                showNotification('error', 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }
            
            const action = user.is_active ? 'Ø¥ÙŠÙ‚Ø§Ù' : 'ØªÙØ¹ÙŠÙ„';
            const confirmMessage = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ${action} Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… "${user.username}"ØŸ`;
            
            if (!confirm(confirmMessage)) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/users/${userId}/toggle`, {
                    method: 'POST'
                });

                const data = await response.json();
                if (data.success) {
                    showNotification('success', data.message || 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                    loadUsers();
                    loadStats();
                } else {
                    showNotification('error', data.error || 'ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                }
            } catch (error) {
                console.error('Error toggling user status:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        async function deleteUser(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) {
                showNotification('error', 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }
            
            const confirmMessage = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… "${user.username}"ØŸ\n\n` +
                `âš ï¸ Ø³ÙŠØªÙ… Ø­Ø°Ù:\n` +
                `- Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹\n` +
                `- Ø¬Ù…ÙŠØ¹ Ø¬Ù„Ø³Ø§ØªÙ‡\n` +
                `- Ø¬Ù…ÙŠØ¹ Ù…ÙØ§ØªÙŠØ­ API Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡\n` +
                `- Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡\n\n` +
                `Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡Ø§!`;
            
            if (!confirm(confirmMessage)) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/users/${userId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                if (data.success) {
                    showNotification('success', `ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… "${user.username}" Ø¨Ù†Ø¬Ø§Ø­`);
                    loadUsers();
                    loadStats();
                } else {
                    showNotification('error', data.error || 'ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        // Bulk actions
        function toggleUserSelection(userId) {
            if (selectedUsers.has(userId)) {
                selectedUsers.delete(userId);
            } else {
                selectedUsers.add(userId);
            }
            updateBulkActions();
        }

        function updateBulkActions() {
            const count = selectedUsers.size;
            document.getElementById('selectedCount').textContent = count;
            document.getElementById('bulkActions').classList.toggle('show', count > 0);
        }

        function toggleBulkActions() {
            const bulkActions = document.getElementById('bulkActions');
            bulkActions.classList.toggle('show');
        }

        function clearSelection() {
            selectedUsers.clear();
            document.querySelectorAll('.user-checkbox').forEach(cb => cb.checked = false);
            updateBulkActions();
        }

        function searchUsers() {
            filterAndSortUsers();
        }

        function filterUsers() {
            filterAndSortUsers();
        }

        function sortUsers() {
            filterAndSortUsers();
        }

        function filterAndSortUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const statusFilter = document.getElementById('userStatusFilter').value;
            const sortBy = document.getElementById('userSortBy').value;
            
            let filtered = users.filter(user => {
                const matchesSearch = !searchTerm || 
                    user.username.toLowerCase().includes(searchTerm) ||
                    user.email.toLowerCase().includes(searchTerm);
                
                const matchesStatus = statusFilter === 'all' ||
                    (statusFilter === 'active' && user.is_active && !user.is_admin) ||
                    (statusFilter === 'inactive' && !user.is_active && !user.is_admin) ||
                    (statusFilter === 'admin' && user.is_admin);
                
                return matchesSearch && matchesStatus;
            });
            
            // ØªØ±ØªÙŠØ¨
            filtered.sort((a, b) => {
                switch(sortBy) {
                    case 'name':
                        return a.username.localeCompare(b.username, 'ar');
                    case 'created':
                        return new Date(b.created_at) - new Date(a.created_at);
                    case 'sessions':
                        return (b.max_sessions || 0) - (a.max_sessions || 0);
                    case 'last_activity':
                        const aDate = a.last_login ? new Date(a.last_login) : new Date(0);
                        const bDate = b.last_login ? new Date(b.last_login) : new Date(0);
                        return bDate - aDate;
                    default:
                        return 0;
                }
            });
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            users = filtered;
            displayUsers();
        }

        function searchSessions() {
            filterAndSortSessions();
        }

        function filterSessions() {
            filterAndSortSessions();
        }

        function sortSessions() {
            filterAndSortSessions();
        }

        function filterAndSortSessions() {
            const searchTerm = document.getElementById('sessionSearch').value.toLowerCase();
            const statusFilter = document.getElementById('sessionStatusFilter').value;
            const userFilter = document.getElementById('sessionUserFilter').value;
            const sortBy = document.getElementById('sessionSortBy').value;
            
            let filtered = sessions.filter(session => {
                const matchesSearch = !searchTerm ||
                    session.session_name.toLowerCase().includes(searchTerm) ||
                    session.username.toLowerCase().includes(searchTerm) ||
                    session.email.toLowerCase().includes(searchTerm) ||
                    String(session.id).includes(searchTerm);
                
                const matchesStatus = statusFilter === 'all' ||
                    session.status === statusFilter;
                
                const matchesUser = userFilter === 'all' ||
                    String(session.user_id) === userFilter;
                
                return matchesSearch && matchesStatus && matchesUser;
            });
            
            // ØªØ±ØªÙŠØ¨
            filtered.sort((a, b) => {
                switch(sortBy) {
                    case 'name':
                        return a.session_name.localeCompare(b.session_name, 'ar');
                    case 'created':
                        return new Date(b.created_at) - new Date(a.created_at);
                    case 'expires':
                        const aExp = a.expires_at ? new Date(a.expires_at) : new Date(0);
                        const bExp = b.expires_at ? new Date(b.expires_at) : new Date(0);
                        return aExp - bExp;
                    case 'status':
                        return a.status.localeCompare(b.status);
                    default:
                        return 0;
                }
            });
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            sessions = filtered;
            displaySessions();
        }

        async function refreshUsers() {
            await loadUsers();
            showNotification('success', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†');
        }

        async function refreshSessions() {
            await loadSessions();
            showNotification('success', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª');
        }

        function exportUsersData() {
            const data = users.map(user => ({
                'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…': user.username,
                'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ': user.email,
                'Ø§Ù„Ø­Ø§Ù„Ø©': user.is_admin ? 'Ø£Ø¯Ù…Ù†' : (user.is_active ? 'Ù†Ø´Ø·' : 'Ù…ÙˆÙ‚ÙˆÙ'),
                'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø¬Ù„Ø³Ø§Øª': user.max_sessions || 1,
                'Ø£ÙŠØ§Ù… Ø§Ù„Ø¬Ù„Ø³Ø©': user.session_ttl_days || 30,
                'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡': formatDate(user.created_at),
                'Ø¢Ø®Ø± Ù†Ø´Ø§Ø·': user.last_login ? formatDate(user.last_login) : 'Ù„Ù… ÙŠØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„'
            }));
            
            exportToCSV(data, 'users_' + new Date().toISOString().split('T')[0] + '.csv');
        }

        function exportSessionsData() {
            const data = sessions.map(session => ({
                'Ø§Ø³Ù… Ø§Ù„Ø¬Ù„Ø³Ø©': session.session_name,
                'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…': session.username,
                'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ': session.email,
                'Ø§Ù„Ø­Ø§Ù„Ø©': session.status,
                'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡': formatDate(session.created_at),
                'Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©': formatDate(session.expires_at),
                'Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©': session.days_remaining || 0,
                'Ù…Ø¹Ù„Ù‚Ø©': session.is_paused ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'
            }));
            
            exportToCSV(data, 'sessions_' + new Date().toISOString().split('T')[0] + '.csv');
        }

        function exportToCSV(data, filename) {
            if (data.length === 0) {
                showNotification('error', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
                return;
            }
            
            const headers = Object.keys(data[0]);
            const csv = [
                headers.join(','),
                ...data.map(row => headers.map(header => {
                    const value = row[header] || '';
                    return `"${String(value).replace(/"/g, '""')}"`;
                }).join(','))
            ].join('\n');
            
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
            
            showNotification('success', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }

        async function viewUserDetails(userId) {
            try {
                const response = await fetch(`/api/admin/users/${userId}/details`);
                const data = await response.json();
                
                if (data.success) {
                    showUserDetailsModal(data.user, data.apiKeys || [], data.sessionTokens || [], data.sessions || []);
                } else {
                    showNotification('error', data.error || 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„');
                }
            } catch (error) {
                console.error('Error loading user details:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        function showUserDetailsModal(user, apiKeys, sessionTokens, userSessions) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'userDetailsModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 900px;">
                    <div class="modal-header">
                        <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${user.username}</h3>
                        <button class="close" onclick="closeModal('userDetailsModal')">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ${user.username}
                            </div>
                            <div>
                                <strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong> ${user.email}
                            </div>
                            <div>
                                <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${user.is_admin ? 'Ø£Ø¯Ù…Ù†' : (user.is_active ? 'Ù†Ø´Ø·' : 'Ù…ÙˆÙ‚ÙˆÙ')}
                            </div>
                            <div>
                                <strong>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø¬Ù„Ø³Ø§Øª:</strong> ${user.max_sessions || 1}
                            </div>
                        </div>
                        
                        <h4>Ù…ÙØ§ØªÙŠØ­ API (${apiKeys.length})</h4>
                        <div style="max-height: 200px; overflow-y: auto; margin-bottom: 20px;">
                            ${apiKeys.length > 0 ? apiKeys.map(key => `
                                <div style="padding: 10px; border: 1px solid #ddd; margin-bottom: 10px; border-radius: 5px;">
                                    <strong>${key.key_name}</strong><br>
                                    <code style="font-size: 12px;">${key.api_key}</code><br>
                                    <small>ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${formatDateWithAgo(key.created_at)}</small>
                                </div>
                            `).join('') : '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙØ§ØªÙŠØ­ API</p>'}
                        </div>
                        
                        <h4>ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø§Øª (${sessionTokens.length})</h4>
                        <div style="max-height: 200px; overflow-y: auto; margin-bottom: 20px;">
                            ${sessionTokens.length > 0 ? sessionTokens.map(token => `
                                <div style="padding: 10px; border: 1px solid #ddd; margin-bottom: 10px; border-radius: 5px;">
                                    <strong>Ø§Ù„Ø¬Ù„Ø³Ø©:</strong> ${token.session_id}<br>
                                    <code style="font-size: 12px;">${token.token}</code><br>
                                    <small>ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${formatDateWithAgo(token.created_at)}</small>
                                </div>
                            `).join('') : '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆÙƒÙ†Ø§Øª</p>'}
                        </div>
                        
                        <h4>Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (${userSessions.length})</h4>
                        <div style="max-height: 200px; overflow-y: auto;">
                            ${userSessions.length > 0 ? userSessions.map(session => `
                                <div style="padding: 10px; border: 1px solid #ddd; margin-bottom: 10px; border-radius: 5px;">
                                    <strong>${session.session_name}</strong> - ${session.status}<br>
                                    <small>ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${formatDateWithAgo(session.created_at)}</small>
                                </div>
                            `).join('') : '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª</p>'}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal('userDetailsModal')">Ø¥ØºÙ„Ø§Ù‚</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.style.display = 'block';
        }

        async function controlSession(sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (!session) {
                showNotification('error', 'Ø§Ù„Ø¬Ù„Ø³Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
                return;
            }
            
            const action = prompt(`Ø§Ø®ØªØ± Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ù„Ø¬Ù„Ø³Ø© "${session.session_name}":\n1. Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„\n2. Ø¥ÙŠÙ‚Ø§Ù\n3. Ø­Ø°Ù`, '1');
            
            try {
                let response;
                switch(action) {
                    case '1':
                        response = await fetch(`/api/admin/sessions/${sessionId}/restart`, { method: 'POST' });
                        break;
                    case '2':
                        response = await fetch(`/api/admin/sessions/${sessionId}/stop`, { method: 'POST' });
                        break;
                    case '3':
                        if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø©ØŸ')) {
                            response = await fetch(`/api/admin/sessions/${sessionId}`, { method: 'DELETE' });
                        } else {
                            return;
                        }
                        break;
                    default:
                        return;
                }
                
                const data = await response.json();
                if (data.success) {
                    showNotification('success', 'ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­');
                    await refreshSessions();
                } else {
                    showNotification('error', data.error || 'ÙØ´Ù„ ÙÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡');
                }
            } catch (error) {
                console.error('Error controlling session:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡');
            }
        }

        // Package management
        async function addPackage() {
            const id = document.getElementById('packageId').value.trim();
            const name = document.getElementById('packageName').value.trim();
            const price = parseFloat(document.getElementById('packagePrice').value);
            const durationDays = parseInt(document.getElementById('packageDuration').value);
            const maxSessions = parseInt(document.getElementById('packageMaxSessions').value);
            const features = document.getElementById('packageFeatures').value.split('\n').filter(f => f.trim());

            if (!id || !name || !price || !durationDays || !maxSessions) {
                showNotification('error', 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }

            try {
                const response = await fetch('/api/admin/packages', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        id, name, price, durationDays, maxSessions, features
                    })
                });

                const data = await response.json();
                if (data.success) {
                    closeModal('addPackageModal');
                    showNotification('success', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­');
                    loadPackages();
                } else {
                    showNotification('error', data.error || 'ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø©');
                }
            } catch (error) {
                console.error('Error adding package:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø©');
            }
        }

        function editPackage(packageId) {
            showNotification('info', 'Ù…ÙŠØ²Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        async function deletePackage(packageId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø§Ù‚Ø©ØŸ')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/packages/${packageId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                if (data.success) {
                    showNotification('success', 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨Ø§Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­');
                    loadPackages();
                } else {
                    showNotification('error', data.error || 'ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¨Ø§Ù‚Ø©');
                }
            } catch (error) {
                console.error('Error deleting package:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¨Ø§Ù‚Ø©');
            }
        }

        // Session management
        function viewSession(sessionId) {
            window.open(`/session/${sessionId}`, '_blank');
        }

        async function restartSession(sessionId) {
            try {
                const response = await fetch(`/api/admin/sessions/${sessionId}/restart`, {
                    method: 'POST'
                });

                const data = await response.json();
                if (data.success) {
                    showNotification('success', 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ù†Ø¬Ø§Ø­');
                    loadSessions();
                } else {
                    showNotification('error', data.error || 'ÙØ´Ù„ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø©');
                }
            } catch (error) {
                console.error('Error restarting session:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø©');
            }
        }

        async function deleteSession(sessionId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø©ØŸ')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/sessions/${sessionId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                if (data.success) {
                    showNotification('success', 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ù†Ø¬Ø§Ø­');
                    loadSessions();
                    loadStats();
                } else {
                    showNotification('error', data.error || 'ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø©');
                }
            } catch (error) {
                console.error('Error deleting session:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø©');
            }
        }

        function viewUserSessions(userId) {
            switchTab('sessions');
            // Filter sessions by user
            const userSessions = sessions.filter(s => s.user_id === userId);
            if (userSessions.length === 0) {
                showNotification('info', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        function editSettings() {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            loadSettings();
            // Ø¥Ø¸Ù‡Ø§Ø± Modal
            const modal = document.getElementById('settingsModal');
            modal.style.display = 'block';
            modal.classList.add('show');
        }

        async function loadSettings() {
            try {
                const response = await fetch('/api/admin/settings');
                const data = await response.json();
                if (data.success) {
                    document.getElementById('adminPhone').value = data.settings.adminPhone || '';
                    document.getElementById('defaultMaxSessions').value = data.settings.defaultMaxSessions || 5;
                    document.getElementById('defaultSessionDays').value = data.settings.defaultSessionDays || 30;
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        async function updateSettings() {
            const adminPhone = document.getElementById('adminPhone').value.trim();
            const defaultMaxSessions = parseInt(document.getElementById('defaultMaxSessions').value);
            const defaultSessionDays = parseInt(document.getElementById('defaultSessionDays').value);

            if (defaultMaxSessions < 1 || defaultMaxSessions > 1000) {
                showNotification('error', 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø¬Ù„Ø³Ø§Øª ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 1 Ùˆ 1000');
                return;
            }

            if (defaultSessionDays < 1 || defaultSessionDays > 9999) {
                showNotification('error', 'Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø¬Ù„Ø³Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 1 Ùˆ 9999');
                return;
            }

            try {
                const response = await fetch('/api/admin/settings', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        adminPhone,
                        defaultMaxSessions,
                        defaultSessionDays
                    })
                });

                const data = await response.json();
                if (data.success) {
                    closeModal('settingsModal');
                    showNotification('success', 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                    loadSettings(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                } else {
                    showNotification('error', data.error || 'ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
                }
            } catch (error) {
                console.error('Error updating settings:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
            }
        }

        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
        async function cleanupExpiredSessions() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©ØŸ')) {
                return;
            }

            try {
                const response = await fetch('/api/admin/cleanup-expired-sessions', {
                    method: 'POST'
                });

                const data = await response.json();
                if (data.success) {
                    showNotification('success', data.message);
                    loadSessions();
                } else {
                    showNotification('error', data.error || 'ÙØ´Ù„ ÙÙŠ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©');
                }
            } catch (error) {
                console.error('Error cleaning up expired sessions:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©');
            }
        }

        // ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø© (Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©)
        function controlSessionAdvanced(sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (!session) return;

            document.getElementById('sessionControlId').value = sessionId;
            document.getElementById('sessionMaxDays').value = session.max_days || 30;
            document.getElementById('sessionDaysRemaining').value = session.days_remaining || 0;
            document.getElementById('sessionIsPaused').value = session.is_paused ? 'true' : 'false';
            document.getElementById('sessionPauseReason').value = session.pause_reason || '';

            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
            const pauseReasonGroup = document.getElementById('pauseReasonGroup');
            pauseReasonGroup.style.display = session.is_paused ? 'block' : 'none';
            
            // Ø¥Ø¶Ø§ÙØ© event listener Ù„ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
            document.getElementById('sessionIsPaused').addEventListener('change', togglePauseReason);

            // Ø¥Ø¸Ù‡Ø§Ø± Modal
            const modal = document.getElementById('sessionControlModal');
            modal.style.display = 'block';
            modal.classList.add('show');
        }

        // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
        function togglePauseReason() {
            const isPaused = document.getElementById('sessionIsPaused').value === 'true';
            const pauseReasonGroup = document.getElementById('pauseReasonGroup');
            pauseReasonGroup.style.display = isPaused ? 'block' : 'none';
        }

        // ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©
        async function updateSessionSettings() {
            const sessionId = document.getElementById('sessionControlId').value;
            const maxDays = parseInt(document.getElementById('sessionMaxDays').value);
            const daysRemaining = parseInt(document.getElementById('sessionDaysRemaining').value);
            const isPaused = document.getElementById('sessionIsPaused').value === 'true';
            const pauseReason = document.getElementById('sessionPauseReason').value;

            if (maxDays < 1 || maxDays > 9999) {
                showNotification('error', 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø£ÙŠØ§Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 1 Ùˆ 9999');
                return;
            }

            if (daysRemaining < 0 || daysRemaining > maxDays) {
                showNotification('error', 'Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¨ÙŠÙ† 0 Ùˆ ' + maxDays);
                return;
            }

            try {
                const response = await fetch(`/api/admin/sessions/${sessionId}/settings`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ maxDays, daysRemaining, isPaused, pauseReason })
                });

                const data = await response.json();
                if (data.success) {
                    closeModal('sessionControlModal');
                    showNotification('success', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ù†Ø¬Ø§Ø­');
                    loadSessions();
                } else {
                    showNotification('error', data.error || 'ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©');
                }
            } catch (error) {
                console.error('Error updating session settings:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©');
            }
        }

        // ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ø³Ø±Ø¹Ø©
        async function extendSessionQuick(sessionId, days) {
            try {
                const response = await fetch(`/api/admin/sessions/${sessionId}/extend`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ days })
                });

                const data = await response.json();
                if (data.success) {
                    showNotification('success', `ØªÙ… ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ù€ ${days} ÙŠÙˆÙ…`);
                    loadSessions();
                } else {
                    showNotification('error', data.error || 'ÙØ´Ù„ ÙÙŠ ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ù„Ø³Ø©');
                }
            } catch (error) {
                console.error('Error extending session:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ù„Ø³Ø©');
            }
        }

        // Ø¥ÙŠÙ‚Ø§Ù/ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø©
        async function toggleSessionPause(sessionId, currentPauseStatus) {
            const isPaused = !currentPauseStatus;
            let pauseReason = '';

            if (isPaused) {
                pauseReason = prompt('Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¬Ù„Ø³Ø©:');
                if (pauseReason === null) return; // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ù„ØºÙ‰
            }

            try {
                const response = await fetch(`/api/admin/sessions/${sessionId}/toggle-pause`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ isPaused, pauseReason })
                });

                const data = await response.json();
                if (data.success) {
                    showNotification('success', data.message);
                    loadSessions();
                } else {
                    showNotification('error', data.error || 'ÙØ´Ù„ ÙÙŠ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø©');
                }
            } catch (error) {
                console.error('Error toggling session pause:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø©');
            }
        }

        // ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ù„Ø³Ø© Ù…Ù† Modal
        async function extendSession(days) {
            const sessionId = document.getElementById('sessionControlId').value;
            await extendSessionQuick(sessionId, days);
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¬Ù„Ø³Ø§Øª
        function editUserLimits(userId, maxSessions, sessionTtlDays) {
            document.getElementById('editLimitsUserId').value = userId;
            document.getElementById('editMaxSessions').value = maxSessions;
            document.getElementById('editSessionTtlDays').value = sessionTtlDays;
            // Ø¥Ø¸Ù‡Ø§Ø± Modal
            const modal = document.getElementById('editLimitsModal');
            modal.style.display = 'block';
            modal.classList.add('show');
        }

        async function updateUserLimits() {
            const userId = document.getElementById('editLimitsUserId').value;
            const maxSessions = parseInt(document.getElementById('editMaxSessions').value);
            const sessionTtlDays = parseInt(document.getElementById('editSessionTtlDays').value);

            if (!userId || !maxSessions || !sessionTtlDays) {
                showNotification('error', 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }

            if (maxSessions < 1 || maxSessions > 1000) {
                showNotification('error', 'Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø§Øª ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 1 Ùˆ 1000');
                return;
            }

            if (sessionTtlDays < 1 || sessionTtlDays > 9999) {
                showNotification('error', 'Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø¬Ù„Ø³Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 1 Ùˆ 9999');
                return;
            }

            try {
                const response = await fetch(`/api/admin/users/${userId}/limits`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ maxSessions, sessionTtlDays })
                });

                const data = await response.json();
                if (data.success) {
                    closeModal('editLimitsModal');
                    showNotification('success', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                    loadUsers();
                } else {
                    showNotification('error', data.error || 'ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¬Ù„Ø³Ø§Øª');
                }
            } catch (error) {
                console.error('Error updating user limits:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¬Ù„Ø³Ø§Øª');
            }
        }

        function displayUsers() {
            const container = document.getElementById('usersList');
            
            if (users.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>';
                return;
            }

            let html = '';
            users.forEach(user => {
                const statusClass = user.is_admin ? 'status-admin' : 
                                  user.is_active ? 'status-active' : 'status-inactive';
                const statusText = user.is_admin ? 'Ø£Ø¯Ù…Ù†' : 
                                 user.is_active ? 'Ù†Ø´Ø·' : 'Ù…ÙˆÙ‚ÙˆÙ';

                html += `
                    <div class="user-card">
                        <div class="user-header">
                            <div class="user-info">
                                <h6>${user.username}</h6>
                                <p>${user.email}</p>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="user-status ${statusClass}">${statusText}</span>
                                <input type="checkbox" class="user-checkbox" value="${user.id}" onchange="toggleUserSelection(${user.id})">
                            </div>
                        </div>
                        
                        <div class="user-details">
                            <div class="detail-item">
                                <div class="detail-label">Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©</div>
                                <div class="detail-value" style="font-size: 18px; color: #25D366;">${user.max_sessions || 1}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Ø£ÙŠØ§Ù… Ø§Ù„Ø¬Ù„Ø³Ø©</div>
                                <div class="detail-value" style="font-size: 18px; color: #128C7E;">${user.session_ttl_days || 30} ÙŠÙˆÙ…</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</div>
                                <div class="detail-value">${formatDateWithAgo(user.created_at)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Ø¢Ø®Ø± Ù†Ø´Ø§Ø·</div>
                                <div class="detail-value">${user.last_login ? formatDateWithAgo(user.last_login) : 'Ù„Ù… ÙŠØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„'}</div>
                            </div>
                        </div>
                        
                        <div class="user-actions">
                            <button class="btn btn-info" onclick="viewUserDetails(${user.id})" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©">
                                ğŸ‘ï¸ ØªÙØ§ØµÙŠÙ„
                            </button>
                            <button class="btn btn-primary" onclick="editUser(${user.id})">
                                âœï¸ ØªØ¹Ø¯ÙŠÙ„
                            </button>
                            <button class="btn btn-warning" onclick="toggleUserStatus(${user.id})">
                                ${user.is_active ? 'â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù' : 'â–¶ï¸ ØªÙØ¹ÙŠÙ„'}
                            </button>
                            <button class="btn btn-info" onclick="viewUserSessions(${user.id})">
                                ğŸ“± Ø§Ù„Ø¬Ù„Ø³Ø§Øª
                            </button>
                            <button class="btn btn-secondary" onclick="editUserLimits(${user.id}, ${user.max_sessions || 1}, ${user.session_ttl_days || 30})">
                                âš™ï¸ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¬Ù„Ø³Ø§Øª
                            </button>
                            <button class="btn btn-danger" onclick="deleteUser(${user.id})">
                                ğŸ—‘ï¸ Ø­Ø°Ù
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        async function loadSessions() {
            try {
                const response = await fetch('/api/admin/sessions');
                const data = await response.json();
                if (data.success) {
                    sessions = data.sessions;
                    
                    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ø§Ù„ÙÙ„ØªØ±
                    const userFilter = document.getElementById('sessionUserFilter');
                    if (userFilter) {
                        const uniqueUsers = [...new Set(sessions.map(s => ({ id: s.user_id, name: s.username })))];
                        userFilter.innerHTML = '<option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</option>' +
                            uniqueUsers.map(u => `<option value="${u.id}">${u.name}</option>`).join('');
                    }
                    
                    displaySessions();
                }
            } catch (error) {
                console.error('Error loading sessions:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª');
            }
        }

        function displaySessions() {
            const container = document.getElementById('sessionsList');
            
            if (sessions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª</p>';
                return;
            }

            let html = '';
            sessions.forEach(session => {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
                const isExpired = session.expires_at && new Date(session.expires_at) < new Date();
                const statusClass = session.status === 'connected' ? 'status-active' : 
                                  session.status === 'waiting_for_qr' ? 'status-warning' : 
                                  session.status === 'expired' || isExpired ? 'status-expired' : 'status-inactive';
                const statusText = session.status === 'connected' ? 'Ù…ØªØµÙ„' : 
                                 session.status === 'waiting_for_qr' ? 'Ø§Ù†ØªØ¸Ø§Ø± QR' : 
                                 session.status === 'expired' || isExpired ? 'Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©' : 'ØºÙŠØ± Ù…ØªØµÙ„';

                html += `
                    <div class="user-card">
                        <div class="user-header">
                            <div class="user-info">
                                <h6>${session.session_name}</h6>
                                <p>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${session.username}</p>
                            </div>
                            <span class="user-status ${statusClass}">${statusText}</span>
                        </div>
                        
                        <div class="user-details">
                            <div class="detail-item">
                                <div class="detail-label">Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù„Ø³Ø©</div>
                                <div class="detail-value" style="font-family: monospace; font-size: 14px;">#${session.id}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
                                <div class="detail-value">${session.username} (${session.email})</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</div>
                                <div class="detail-value">${formatDateWithAgo(session.created_at)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</div>
                                <div class="detail-value ${isExpired ? 'text-danger' : ''}" style="font-weight: bold;">${formatDateWithAgo(session.expires_at)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</div>
                                <div class="detail-value ${session.days_remaining <= 3 ? 'text-warning' : ''}" style="font-size: 18px; font-weight: bold;">${session.days_remaining || 0} ÙŠÙˆÙ…</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø£ÙŠØ§Ù…</div>
                                <div class="detail-value" style="color: #666;">${session.max_days || 30} ÙŠÙˆÙ…</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù</div>
                                <div class="detail-value">${session.is_paused ? '<span style="color: #dc3545;">â¸ï¸ Ù…Ø¹Ù„Ù‚Ø©</span>' : '<span style="color: #28a745;">â–¶ï¸ Ù†Ø´Ø·Ø©</span>'}</div>
                            </div>
                            ${session.pause_reason ? `
                            <div class="detail-item" style="grid-column: 1 / -1;">
                                <div class="detail-label">Ø³Ø¨Ø¨ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù</div>
                                <div class="detail-value" style="color: #dc3545; font-style: italic;">${session.pause_reason}</div>
                            </div>
                            ` : ''}
                        </div>
                        
                        <div class="user-actions">
                            <button class="btn btn-primary" onclick="viewSession(${session.id})">
                                ğŸ‘ï¸ Ø¹Ø±Ø¶
                            </button>
                            <button class="btn btn-info" onclick="controlSession(${session.id})">
                                ğŸ›ï¸ ØªØ­ÙƒÙ…
                            </button>
                            <button class="btn btn-success" onclick="extendSessionQuick(${session.id}, 7)">
                                +7 Ø£ÙŠØ§Ù…
                            </button>
                            <button class="btn btn-success" onclick="extendSessionQuick(${session.id}, 30)">
                                +30 ÙŠÙˆÙ…
                            </button>
                            <button class="btn btn-success" onclick="extendSessionQuick(${session.id}, 365)">
                                +1 Ø³Ù†Ø©
                            </button>
                            <button class="btn btn-warning" onclick="toggleSessionPause(${session.id}, ${session.is_paused})">
                                ${session.is_paused ? 'â–¶ï¸ ØªÙØ¹ÙŠÙ„' : 'â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù'}
                            </button>
                            <button class="btn btn-danger" onclick="deleteSession(${session.id})">
                                ğŸ—‘ï¸ Ø­Ø°Ù
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        async function loadPackages() {
            try {
                const response = await fetch('/api/settings');
                const data = await response.json();
                if (data.success && data.packages) {
                    packages = data.packages;
                    displayPackages();
                }
            } catch (error) {
                console.error('Error loading packages:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª');
            }
        }

        function displayPackages() {
            const container = document.getElementById('packagesList');
            
            if (packages.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø§Ù‚Ø§Øª</p>';
                return;
            }

            let html = '';
            packages.forEach(pkg => {
                html += `
                    <div class="user-card">
                        <div class="user-header">
                            <div class="user-info">
                                <h6>${pkg.name}</h6>
                                <p>Ù…Ø¹Ø±Ù: ${pkg.id}</p>
                            </div>
                            <div style="font-size: 24px; font-weight: bold; color: #25D366;">
                                $${pkg.price}
                            </div>
                        </div>
                        
                        <div class="user-details">
                            <div class="detail-item">
                                <div class="detail-label">Ø§Ù„Ù…Ø¯Ø©</div>
                                <div class="detail-value">${pkg.durationDays} ÙŠÙˆÙ…</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø¬Ù„Ø³Ø§Øª</div>
                                <div class="detail-value">${pkg.maxSessions}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª</div>
                                <div class="detail-value">${pkg.features ? pkg.features.length : 0} Ù…ÙŠØ²Ø©</div>
                            </div>
                        </div>
                        
                        <div class="user-actions">
                            <button class="btn btn-primary" onclick="editPackage('${pkg.id}')">
                                âœï¸ ØªØ¹Ø¯ÙŠÙ„
                            </button>
                            <button class="btn btn-danger" onclick="deletePackage('${pkg.id}')">
                                ğŸ—‘ï¸ Ø­Ø°Ù
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        async function loadSettings() {
            try {
                const response = await fetch('/api/admin/settings');
                const data = await response.json();
                if (data.success) {
                    displaySettings(data.settings);
                }
            } catch (error) {
                console.error('Error loading settings:', error);
                showNotification('error', 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
            }
        }

        function displaySettings(settings) {
            const container = document.getElementById('settingsContent');
            
            container.innerHTML = `
                <div class="user-card">
                    <h4>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ø©</h4>
                    <div class="user-details">
                        <div class="detail-item">
                            <div class="detail-label">Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø£Ø¯Ù…Ù†</div>
                            <div class="detail-value">${settings.adminPhone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„Ø£Ø¯Ù…Ù†</div>
                            <div class="detail-value">${settings.adminEmail || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</div>
                            <div class="detail-value">${settings.defaultSessionTtl || 30} ÙŠÙˆÙ…</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</div>
                            <div class="detail-value">${settings.defaultMaxSessions || 1}</div>
                        </div>
                    </div>
                    <div class="user-actions">
                        <button class="btn btn-primary" onclick="editSettings()">
                            âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                        </button>
                    </div>
                </div>
            `;
        }

        async function loadStats() {
            try {
                const response = await fetch('/api/admin/stats');
                const data = await response.json();
                if (data.success) {
                    const stats = data.stats;
                    document.getElementById('totalUsers').textContent = stats.totalUsers || 0;
                    document.getElementById('activeUsers').textContent = stats.activeUsers || 0;
                    document.getElementById('totalSessions').textContent = stats.totalSessions || 0;
                    document.getElementById('connectedSessions').textContent = stats.connectedSessions || 0;
                    document.getElementById('totalMessages').textContent = stats.messages24h || 0;
                    document.getElementById('apiCalls').textContent = stats.api24h || 0;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        async function loadUsers() {
            try {
                const response = await fetch('/api/admin/users');
                const data = await response.json();
                if (data.success) {
                    users = data.users;
                    displayUsers();
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        function displayUsers() {
            const container = document.getElementById('usersList');
            
            if (users.length === 0) {
                container.innerHTML = '<p class="text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>';
                return;
            }

            let html = '';
            users.forEach(user => {
                const statusClass = user.is_admin ? 'status-admin' : 
                                  user.is_active ? 'status-active' : 'status-inactive';
                const statusText = user.is_admin ? 'Ø£Ø¯Ù…Ù†' : 
                                 user.is_active ? 'Ù†Ø´Ø·' : 'Ù…ÙˆÙ‚ÙˆÙ';

                html += `
                    <div class="user-card">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h6 class="mb-1">${user.username}</h6>
                                <p class="text-muted mb-2">${user.email}</p>
                                <div class="d-flex align-items-center gap-3">
                                    <span class="user-status ${statusClass}">${statusText}</span>
                                    <small class="text-muted">
                                        <i class="fas fa-users me-1"></i>
                                        ${user.max_sessions} Ø¬Ù„Ø³Ø©
                                    </small>
                                    <small class="text-muted">
                                        <i class="fas fa-clock me-1"></i>
                                        ${user.session_ttl_days || 30} ÙŠÙˆÙ…
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-4 text-end">
                                <div class="btn-group" role="group">
                                    <button class="action-btn btn-edit" onclick="editUser(${user.id})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn btn-toggle" onclick="toggleUserStatus(${user.id})">
                                        <i class="fas fa-${user.is_active ? 'ban' : 'check'}"></i>
                                    </button>
                                    <button class="action-btn btn-delete" onclick="deleteUser(${user.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        async function loadPackages() {
            try {
                const response = await fetch('/api/settings');
                const data = await response.json();
                if (data.success && data.packages) {
                    packages = data.packages;
                    displayPackages();
                }
            } catch (error) {
                console.error('Error loading packages:', error);
            }
        }

        function displayPackages() {
            const container = document.getElementById('packagesList');
            
            if (packages.length === 0) {
                container.innerHTML = '<p class="text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø§Ù‚Ø§Øª</p>';
                return;
            }

            let html = '';
            packages.forEach(pkg => {
                html += `
                    <div class="package-card">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h6 class="mb-1">${pkg.name}</h6>
                                <div class="package-price">$${pkg.price} USD</div>
                                <ul class="feature-list">
                                    ${pkg.features.map(feature => `<li>${feature}</li>`).join('')}
                                </ul>
                                <small class="text-muted">
                                    <i class="fas fa-clock me-1"></i>
                                    ${pkg.durationDays} ÙŠÙˆÙ…
                                </small>
                            </div>
                            <div class="col-md-4 text-end">
                                <div class="btn-group" role="group">
                                    <button class="action-btn btn-edit" onclick="editPackage('${pkg.id}')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn btn-delete" onclick="deletePackage('${pkg.id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        async function loadSubscriptions() {
            try {
                const response = await fetch('/api/admin/subscriptions');
                const data = await response.json();
                if (data.success) {
                    subscriptions = data.subscriptions;
                    displaySubscriptions();
                }
            } catch (error) {
                console.error('Error loading subscriptions:', error);
            }
        }

        function displaySubscriptions() {
            const container = document.getElementById('subscriptionsList');
            
            if (subscriptions.length === 0) {
                container.innerHTML = '<p class="text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</p>';
                return;
            }

            let html = `
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                <th>Ø§Ù„Ø¨Ø§Ù‚Ø©</th>
                                <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            subscriptions.forEach(sub => {
                const startDate = formatDate(sub.startDate);
                const endDate = formatDate(sub.endDate);
                const statusClass = sub.status === 'active' ? 'badge bg-success' : 'badge bg-danger';
                const statusText = sub.status === 'active' ? 'Ù†Ø´Ø·' : 'Ù…Ù†ØªÙ‡ÙŠ';

                html += `
                    <tr>
                        <td>${sub.username}</td>
                        <td>${sub.packageName}</td>
                        <td>$${sub.price} ${sub.currency}</td>
                        <td>${startDate}</td>
                        <td>${endDate}</td>
                        <td><span class="${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline-danger" onclick="cancelSubscription(${sub.id})">
                                <i class="fas fa-times"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                </div>
            `;

            container.innerHTML = html;
        }


        function showAddPackageModal() {
            const modal = new bootstrap.Modal(document.getElementById('addPackageModal'));
            modal.show();
        }

        async function addUser() {
            const username = document.getElementById('newUsername').value.trim();
            const email = document.getElementById('newEmail').value.trim();
            const password = document.getElementById('newPassword').value;
            const maxSessions = parseInt(document.getElementById('newMaxSessions').value);
            const isAdmin = document.getElementById('newIsAdmin').checked;

            if (!username || !email || !password) {
                showErrorMessage('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }

            try {
                const response = await fetch('/api/admin/users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username,
                        email,
                        password,
                        maxSessions,
                        isAdmin
                    })
                });

                const data = await response.json();
                if (data.success) {
                    bootstrap.Modal.getInstance(document.getElementById('addUserModal')).hide();
                    showSuccessMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                    loadUsers();
                    loadStats();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error adding user:', error);
                showErrorMessage('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        async function addPackage() {
            const id = document.getElementById('packageId').value.trim();
            const name = document.getElementById('packageName').value.trim();
            const price = parseFloat(document.getElementById('packagePrice').value);
            const durationDays = parseInt(document.getElementById('packageDuration').value);
            const maxSessions = parseInt(document.getElementById('packageMaxSessions').value);
            const features = document.getElementById('packageFeatures').value.split('\n').filter(f => f.trim());

            if (!id || !name || !price || !durationDays || !maxSessions) {
                showErrorMessage('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }

            try {
                const response = await fetch('/api/admin/packages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id,
                        name,
                        price,
                        durationDays,
                        maxSessions,
                        features
                    })
                });

                const data = await response.json();
                if (data.success) {
                    bootstrap.Modal.getInstance(document.getElementById('addPackageModal')).hide();
                    showSuccessMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­');
                    loadPackages();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error adding package:', error);
                showErrorMessage('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø©');
            }
        }

        async function toggleUserStatus(userId) {
            try {
                const response = await fetch(`/api/admin/users/${userId}/toggle`, {
                    method: 'POST'
                });

                const data = await response.json();
                if (data.success) {
                    showSuccessMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                    loadUsers();
                    loadStats();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error toggling user status:', error);
                showErrorMessage('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        async function deleteUser(userId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/users/${userId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                if (data.success) {
                    showSuccessMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                    loadUsers();
                    loadStats();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                showErrorMessage('ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        function editUser(userId) {
            // Implement edit user functionality
            showInfoMessage('Ù…ÙŠØ²Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        function editPackage(packageId) {
            // Implement edit package functionality
            showInfoMessage('Ù…ÙŠØ²Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        async function deletePackage(packageId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø§Ù‚Ø©ØŸ')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/packages/${packageId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                if (data.success) {
                    showSuccessMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨Ø§Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­');
                    loadPackages();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error deleting package:', error);
                showErrorMessage('ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¨Ø§Ù‚Ø©');
            }
        }

        async function cancelSubscription(subscriptionId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØŸ')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/subscriptions/${subscriptionId}/cancel`, {
                    method: 'POST'
                });

                const data = await response.json();
                if (data.success) {
                    showSuccessMessage('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù†Ø¬Ø§Ø­');
                    loadSubscriptions();
                    loadStats();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error canceling subscription:', error);
                showErrorMessage('ÙØ´Ù„ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ');
            }
        }

        function showSuccessMessage(message) {
            const notification = document.createElement('div');
            notification.className = 'alert alert-success alert-dismissible fade show position-fixed';
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <i class="fas fa-check-circle me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function showErrorMessage(message) {
            const notification = document.createElement('div');
            notification.className = 'alert alert-danger alert-dismissible fade show position-fixed';
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <i class="fas fa-exclamation-circle me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function showInfoMessage(message) {
            const notification = document.createElement('div');
            notification.className = 'alert alert-info alert-dismissible fade show position-fixed';
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <i class="fas fa-info-circle me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function logout() {
            fetch('/logout')
                .then(() => {
                    window.location.href = '/';
                })
                .catch(error => {
                    console.error('Logout error:', error);
                    window.location.href = '/';
                });
        }
    </script>
    <!-- Improvements JS -->
    <script src="js/toast.js"></script>
    <script src="js/dark-mode.js"></script>
    <script src="js/skeleton.js"></script>
    <script src="js/utils.js"></script>
</body>
</html>


