# دليل اختبار API محدث

## 🎯 المشكلة المحلولة

تم حل مشكلة `404 Not Found` من خلال:
1. **إصلاح ربط التوكن بالجلسة**: الآن التوكن مرتبط بـ `sessionId` الفعلي وليس `session_name`
2. **إضافة قسم معلومات التوكن في صفحة الجلسة**: يمكنك الآن رؤية التوكن مباشرة في صفحة الجلسة
3. **إضافة مسار جديد**: `/api/session/:sessionId/token` للحصول على توكن جلسة محددة

## 🔧 كيفية الحصول على التوكن الصحيح

### الطريقة 1: من صفحة الجلسة (الأسهل)
1. افتح `http://localhost:3000`
2. سجل دخول واذهب للداش بورد
3. اضغط على أي جلسة متصلة
4. ستجد قسم "🔑 معلومات API" في أعلى الصفحة
5. انسخ التوكن من هناك

### الطريقة 2: من صفحة إدارة API
1. اذهب لـ "🔑 إدارة API"
2. انسخ التوكن من الجلسة المتصلة

## 🧪 اختبار API في Postman

### الخطوة 1: الحصول على المفاتيح
```
API Key: wa_feb5926b862827399cd5ff96bdf489e2074194cd2a65b5d328df7b19b6af904e
Session Token: [انسخ من صفحة الجلسة]
```

### الخطوة 2: اختبار حالة الجلسة
```
GET http://localhost:3000/api/session-status
Headers:
  X-API-Key: wa_feb5926b862827399cd5ff96bdf489e2074194cd2a65b5d328df7b19b6af904e
  X-Session-Token: [التوكن من صفحة الجلسة]
```

### الخطوة 3: إرسال رسالة
```
POST http://localhost:3000/api/send-message
Headers:
  X-API-Key: wa_feb5926b862827399cd5ff96bdf489e2074194cd2a65b5d328df7b19b6af904e
  X-Session-Token: [التوكن من صفحة الجلسة]
  Content-Type: application/json
Body:
{
  "to": "966501234567",
  "message": "مرحباً! هذا اختبار من Postman 🚀"
}
```

## ✅ الاستجابات المتوقعة

### نجح:
```json
{
  "success": true,
  "message": "تم إرسال الرسالة بنجاح",
  "messageId": "3EB0C767D123456789",
  "timestamp": "2024-01-15T10:30:00.000Z"
}
```

### خطأ 404 (محلول):
```json
{
  "success": false,
  "error": "الجلسة غير موجودة أو غير متصلة",
  "code": "SESSION_NOT_FOUND"
}
```

## 🔍 نصائح مهمة

1. **تأكد من اتصال الجلسة** قبل الاختبار
2. **استخدم التوكن من صفحة الجلسة** وليس من صفحة إدارة API
3. **تأكد من أن الجلسة متصلة** (status: connected)
4. **استخدم أرقام هواتف صحيحة** للاختبار

## 🛠️ المسارات الجديدة

### الحصول على توكن جلسة محددة:
```
GET /api/session/:sessionId/token
```

### إعادة إنشاء توكن جلسة:
```
POST /api/regenerate-session-token
Body: { "sessionId": "123" }
```

## 📱 ميزات جديدة في صفحة الجلسة

- **عرض التوكن مباشرة** في أعلى الصفحة
- **زر نسخ التوكن** بنقرة واحدة
- **زر إعادة إنشاء التوكن** إذا احتجت
- **معلومات الجلسة** (ID, الاسم, الحالة)

---

**ملاحظة:** الآن كل جلسة لها توكن خاص بها، ويمكنك رؤيته مباشرة في صفحة الجلسة! 🎉
